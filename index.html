<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RSQ Key System</title>

<style>
body {
  margin:0;
  background:#0b0e14;
  font-family:system-ui;
  color:white;
}
.hidden { display:none; }

.panel {
  width:520px;
  background:#141822;
  border-radius:18px;
  padding:22px;
  box-shadow:0 0 60px rgba(0,120,255,.3);
  margin:auto;
  margin-top:10vh;
}

button,input,select,textarea {
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:8px;
  border:none;
  font-size:14px;
}

input,select,textarea {
  background:#0b0f18;
  color:white;
  border:1px solid #222;
}

textarea {
  height:120px;
  resize:none;
}

button {
  background:linear-gradient(135deg,#4f7cff,#3fd2ff);
  font-weight:bold;
  cursor:pointer;
}
button.danger {
  background:linear-gradient(135deg,#ff3b30,#ff453a);
}
button.secondary {
  background:linear-gradient(135deg,#ff8a00,#ffb300);
}

.status {
  text-align:center;
  margin-top:8px;
  font-size:13px;
}
.keyDisplay {
  text-align:center;
  margin-top:6px;
  font-size:13px;
  color:#3fd2ff;
  word-break:break-all;
}

.adminFull {
  position:fixed;
  inset:0;
  background:#0b0e14;
  padding:20px;
  overflow:auto;
}

.keyRow {
  background:#111625;
  border-radius:10px;
  padding:12px;
  margin-bottom:12px;
  font-size:12px;
}

.topRight {
  position:absolute;
  top:16px;
  right:16px;
}

hr { opacity:.2 }
</style>
</head>

<body>

<!-- USER PANEL -->
<div id="userPanel" class="panel">
  <h2 style="text-align:center">üîê RSQ Key System</h2>

  <input id="userid" placeholder="Roblox UserId">
  <button id="genBtn">Generate / Recover Key</button>

  <div id="status" class="status"></div>
  <div id="keyOut" class="keyDisplay"></div>

  <button id="adminBtn" class="danger">üëë Admin Panel</button>
  <button class="secondary" onclick="openFeedback()">üì® Feedback / Appeal</button>
  <input id="adminInput" class="hidden" placeholder="Admin Master Key">
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="adminFull hidden">
  <h2>üëë ADMIN PANEL</h2>
  <button onclick="exitAdmin()">Exit Admin Panel</button>
  <button class="secondary" onclick="openForms()">üìã See Feedback</button>

  <hr>

  <h3>üö´ Ban UserId</h3>
  <input id="banUserId" placeholder="Roblox UserId">
  <select id="banDuration">
    <option value="3600">1 Hour</option>
    <option value="86400">1 Day</option>
    <option value="604800">1 Week</option>
    <option value="2592000">1 Month</option>
    <option value="31536000">1 Year</option>
  </select>
  <button class="danger" onclick="banUser()">Ban User (Deletes All Keys)</button>

  <hr>

  <h3>üîë Key Logs</h3>
  <div id="keyLogs"></div>

  <hr>

  <h3>üìú Ban Logs</h3>
  <div id="banLogs"></div>
</div>

<!-- FEEDBACK PANEL -->
<div id="feedbackPanel" class="panel hidden">
  <button class="topRight" onclick="backToUser()">‚¨Ö Back</button>
  <h2>üì® Appeal / Feedback</h2>
  <input id="fbUser" placeholder="Username or UserId">
  <textarea id="fbMsg" placeholder="Explain why you should be unbanned"></textarea>
  <button onclick="submitFeedback()">Send Appeal</button>
  <div id="fbStatus" class="status"></div>
</div>

<!-- FEEDBACK ADMIN -->
<div id="formsPanel" class="adminFull hidden">
  <h2>üìã Feedback Forms</h2>
  <button onclick="backToAdmin()">‚¨Ö Back</button>
  <input id="searchInput" placeholder="Search by UserId / Username" oninput="renderForms()">
  <div id="formsList"></div>
</div>

<script>
/* ================= CONFIG ================= */
const BIN_ID = "694c4aefae596e708faef157";
const JSONBIN_KEY = "$2a$10$DgQd.qgYLB2nv9e9ZFktKeUUkzZfmqPnL4Fk7JLvnN/ASlctW.8Cu";
const ADMIN_MASTER_KEY = "roblox";
const KEY_LIFE = 86400;
const FEEDBACK_WEBHOOK = "PUT_DISCORD_WEBHOOK_URL_HERE";
const FEEDBACK_COOLDOWN = 60;

/* ================= HELPERS ================= */
const now = () => Math.floor(Date.now()/1000);
const uuid = () => crypto.randomUUID();

function copy(t){ navigator.clipboard.writeText(t); }

/* ================= JSONBIN ================= */
async function getData(){
  const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`);
  return (await r.json()).record || {};
}
async function saveData(d){
  await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`,{
    method:"PUT",
    headers:{
      "Content-Type":"application/json",
      "X-Master-Key":JSONBIN_KEY
    },
    body:JSON.stringify(d)
  });
}

/* ================= WEBHOOK ================= */
async function sendFeedbackWebhook(user,msg){
  if(!FEEDBACK_WEBHOOK.includes("discord")) return;
  await fetch(FEEDBACK_WEBHOOK,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      content:"@here",
      embeds:[{
        title:"üì® New Ban Appeal",
        color:5793266,
        fields:[
          {name:"User",value:user},
          {name:"Message",value:msg}
        ],
        timestamp:new Date().toISOString()
      }]
    })
  });
}

/* ================= FEEDBACK ================= */
function openFeedback(){
  userPanel.classList.add("hidden");
  feedbackPanel.classList.remove("hidden");
}
function backToUser(){
  feedbackPanel.classList.add("hidden");
  userPanel.classList.remove("hidden");
}

async function submitFeedback(){
  const last = Number(localStorage.rsqFbCooldown || 0);
  if(now() - last < FEEDBACK_COOLDOWN){
    fbStatus.textContent = "‚è≥ Please wait before submitting again.";
    return;
  }

  const user = fbUser.value.trim();
  const msg = fbMsg.value.trim();
  if(!user || !msg) return;

  const data = await getData();
  data.feedback ||= [];
  data.feedback.push({
    id: uuid(),
    user,
    message: msg,
    time: now()
  });

  await saveData(data);
  await sendFeedbackWebhook(user,msg);

  localStorage.rsqFbCooldown = now();
  fbStatus.textContent = "‚úÖ Thank you, we will notify you shortly.";
  fbUser.value = "";
  fbMsg.value = "";
}

/* ================= ADMIN FEEDBACK ================= */
let cachedFeedback = [];

async function openForms(){
  adminPanel.classList.add("hidden");
  formsPanel.classList.remove("hidden");
  const data = await getData();
  cachedFeedback = data.feedback || [];
  renderForms();
}

function renderForms(){
  const q = searchInput.value.toLowerCase();
  formsList.innerHTML = "";
  cachedFeedback
    .filter(f => f.user.toLowerCase().includes(q))
    .forEach(f=>{
      const div = document.createElement("div");
      div.className="keyRow";
      div.innerHTML = `
<b>${f.user}</b><br>
${f.message}<br>
<small>${new Date(f.time*1000).toLocaleString()}</small>
`;
      const del = document.createElement("button");
      del.className="danger";
      del.textContent="Resolve / Delete";
      del.onclick = ()=>deleteFeedback(f.id);
      div.appendChild(del);
      formsList.appendChild(div);
    });
}

async function deleteFeedback(id){
  const data = await getData();
  data.feedback = (data.feedback||[]).filter(f=>f.id!==id);
  await saveData(data);
  cachedFeedback = data.feedback;
  renderForms();
}

function backToAdmin(){
  formsPanel.classList.add("hidden");
  adminPanel.classList.remove("hidden");
}
</script>
</body>
</html>
