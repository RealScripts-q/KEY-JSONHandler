<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RSQ Key System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#070707;
  font-family:system-ui;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}
.card{
  width:460px;
  background:#121212;
  border-radius:18px;
  padding:20px;
  box-shadow:0 0 40px rgba(0,120,255,.25);
}
h1{font-size:18px;margin:0}
p{font-size:13px;color:#aaa}

input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:none;
}
input{
  background:#0b0b0b;
  color:#fff;
  border:1px solid #222;
}
button{
  background:linear-gradient(135deg,#007aff,#00c6ff);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}
.secondary{
  background:linear-gradient(135deg,#ff6a00,#ff9500);
}
.danger{
  background:linear-gradient(135deg,#ff3b3b,#ff0000);
}
.hidden{display:none}

.status{margin-top:10px;font-size:13px}
.timer{margin-top:8px;font-size:13px;color:#00c6ff}
.cooldown{margin-top:6px;font-size:12px;color:#ff9500}

.topLeft{
  position:fixed;
  top:10px;
  left:10px;
  font-size:12px;
  color:#00c6ff;
}

/* ADMIN */
.admin{
  position:fixed;
  inset:0;
  background:#070707;
  padding:20px;
  overflow:auto;
}
.log{
  background:#0c0c0c;
  padding:10px;
  border-radius:10px;
  margin-top:8px;
  font-size:12px;
}
</style>
</head>

<body>

<div class="topLeft" id="requestDisplay"></div>

<div class="card" id="userUI">
<h1>ðŸ”‘ RSQ Key System</h1>
<p>Paste your Roblox UserId</p>

<input id="userid" placeholder="Roblox UserId">
<button id="gen">Generate / Recover Key</button>

<!-- REQUEST ID -->
<button id="showRequest" class="secondary">Use Request ID</button>
<input id="requestInput" class="hidden" placeholder="Paste Request ID">
<button id="approveRequest" class="secondary hidden">Approve Request ID</button>

<!-- MASTER -->
<button id="showAdmin" class="secondary">Admin / Master Login</button>
<input id="adminInput" class="hidden" placeholder="Paste Master Key">
<button id="approveAdmin" class="secondary hidden">Approve Master Key</button>

<!-- FORCE / RENEW -->
<button id="renewBtn" class="secondary hidden">ðŸ”„ Force / Renew Key</button>

<button id="openAdmin" class="secondary hidden">Open Admin Panel</button>

<div class="status" id="status"></div>
<div class="timer" id="timer"></div>
<div class="cooldown" id="cooldown"></div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="admin hidden">
<h1>ðŸ‘‘ Admin Panel</h1>
<button onclick="closeAdmin()">Close</button>

<input id="infUser" placeholder="UserId for INF key">
<button onclick="genInf()">Generate INF Key</button>

<h2>ðŸ“œ Logs</h2>
<button onclick="loadLogs()">Refresh Logs</button>
<div id="logs"></div>
</div>

<script>
/* CONFIG */
const BIN_ID = "694c4aefae596e708faef157";
const JSONBIN_MASTER_KEY = "$2a$10$DgQd.qgYLB2nv9e9ZFktKeUUkzZfmqPnL4Fk7JLvnN/ASlctW.8Cu";
const ADMIN_MASTER_KEY = "RSQ-MASTER-KEY";

const KEY_LIFE = 86400;
const RESET_COOLDOWN = 21600;

/* STATE */
let isAdmin=false;
let approvedRequest=false;
let keyTimer=null;
let cooldownTimer=null;

/* HELPERS */
const now=()=>Math.floor(Date.now()/1000);
const makeKey=()=> "RSQ-"+crypto.randomUUID().slice(0,8).toUpperCase();

/* JSONBIN */
async function getKeys(){
  const r=await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`);
  return (await r.json()).record.keys||{};
}
async function saveKeys(keys){
  await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`,{
    method:"PUT",
    headers:{
      "Content-Type":"application/json",
      "X-Master-Key":JSONBIN_MASTER_KEY
    },
    body:JSON.stringify({keys})
  });
}

/* TIMER */
function startTimer(exp){
  clearInterval(keyTimer);
  timer.classList.remove("hidden");
  keyTimer=setInterval(()=>{
    const r=exp-now();
    if(r<=0){
      timer.textContent="â›” Key expired";
      clearInterval(keyTimer);
      return;
    }
    timer.textContent=`â± ${Math.floor(r/3600)}h ${Math.floor(r%3600/60)}m ${r%60}s`;
  },1000);
}
function startCooldown(last){
  clearInterval(cooldownTimer);
  function tick(){
    const r=(last+RESET_COOLDOWN)-now();
    if(r<=0){
      cooldown.textContent="";
      renewBtn.classList.remove("hidden");
      clearInterval(cooldownTimer);
      return;
    }
    renewBtn.classList.add("hidden");
    cooldown.textContent=`ðŸ”’ Reset cooldown ${Math.floor(r/3600)}h ${Math.floor(r%3600/60)}m ${r%60}s`;
  }
  tick();
  cooldownTimer=setInterval(tick,1000);
}

/* GENERATE */
gen.onclick=async()=>{
  if(!approvedRequest && !isAdmin)
    return status.textContent="âŒ Approve Request ID or Master first";

  const id=userid.value.trim();
  if(!/^\d+$/.test(id)) return status.textContent="âŒ Invalid UserId";

  const keys=await getKeys();
  for(const k in keys){
    const d=keys[k];
    if(d.userId==id){
      navigator.clipboard.writeText(k);
      status.textContent="âœ… Existing key copied";
      renewBtn.classList.remove("hidden");
      if(d.inf){
        timer.textContent="â™¾ Expires: NEVER";
      }else{
        startTimer(d.expires);
        if(d.lastReset) startCooldown(d.lastReset);
      }
      return;
    }
  }

  const k=makeKey();
  keys[k]={userId:id,created:now(),expires:now()+KEY_LIFE,lastReset:0};
  await saveKeys(keys);
  navigator.clipboard.writeText(k);
  status.textContent="âœ… New key generated & copied";
  startTimer(keys[k].expires);
  renewBtn.classList.remove("hidden");
};

/* FORCE / RENEW */
renewBtn.onclick=async()=>{
  const id=userid.value.trim();
  const keys=await getKeys();
  for(const k in keys){
    const d=keys[k];
    if(d.userId==id && !d.inf){
      if(d.lastReset && now()-d.lastReset<RESET_COOLDOWN)
        return status.textContent="â³ Cooldown active";
      d.expires=now()+KEY_LIFE;
      d.lastReset=now();
      await saveKeys(keys);
      status.textContent="ðŸ”„ Key renewed";
      startTimer(d.expires);
      startCooldown(d.lastReset);
      return;
    }
  }
};

/* REQUEST ID FLOW */
showRequest.onclick=()=>{
  requestInput.classList.toggle("hidden");
  approveRequest.classList.toggle("hidden");
};
approveRequest.onclick=()=>{
  approvedRequest=true;
  requestDisplay.textContent="Request ID: "+requestInput.value;
  status.textContent="âœ… Request ID approved";
};

/* ADMIN FLOW */
showAdmin.onclick=()=>{
  adminInput.classList.toggle("hidden");
  approveAdmin.classList.toggle("hidden");
};
approveAdmin.onclick=()=>{
  if(adminInput.value!==ADMIN_MASTER_KEY)
    return status.textContent="âŒ Invalid master key";
  isAdmin=true;
  openAdmin.classList.remove("hidden");
  status.textContent="ðŸ‘‘ Welcome Admin";
};

/* ADMIN PANEL */
openAdmin.onclick=()=>{
  userUI.classList.add("hidden");
  adminPanel.classList.remove("hidden");
  loadLogs();
};
async function loadLogs(){
  logs.innerHTML="";
  const keys=await getKeys();
  for(const k in keys){
    const d=keys[k];
    const div=document.createElement("div");
    div.className="log";
    div.innerHTML=`
<b>${k}</b><br>
UID: ${d.userId}<br>
Expires: ${d.inf?"NEVER":new Date(d.expires*1000)}<br>
<button onclick="renewKey('${k}')">Renew</button>
<button class="danger" onclick="delKey('${k}')">Delete</button>`;
    logs.appendChild(div);
  }
}
async function renewKey(k){
  const keys=await getKeys();
  if(keys[k]&&!keys[k].inf){
    keys[k].expires=now()+KEY_LIFE;
    await saveKeys(keys);
    loadLogs();
  }
}
async function delKey(k){
  const keys=await getKeys();
  delete keys[k];
  await saveKeys(keys);
  loadLogs();
}
async function genInf(){
  const id=infUser.value.trim();
  if(!/^\d+$/.test(id))return;
  const keys=await getKeys();
  const k=makeKey();
  keys[k]={userId:id,inf:true};
  await saveKeys(keys);
  navigator.clipboard.writeText(k);
  alert("INF key copied");
}
function closeAdmin(){
  location.reload();
}
</script>

</body>
</html>
