<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RSQ Key System</title>

<style>
body {
  margin:0;
  background:#0b0e14;
  font-family:system-ui;
  color:white;
}
.hidden { display:none; }

.panel {
  width:520px;
  background:#141822;
  border-radius:18px;
  padding:22px;
  box-shadow:0 0 60px rgba(0,120,255,.3);
  margin:auto;
  margin-top:10vh;
}

button,input,select,textarea {
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:8px;
  border:none;
  font-size:14px;
}

input,select,textarea {
  background:#0b0f18;
  color:white;
  border:1px solid #222;
}

button {
  background:linear-gradient(135deg,#4f7cff,#3fd2ff);
  font-weight:bold;
  cursor:pointer;
}
button.danger {
  background:linear-gradient(135deg,#ff3b30,#ff453a);
}
button.secondary {
  background:linear-gradient(135deg,#ff8a00,#ffb300);
}

.status {
  text-align:center;
  margin-top:8px;
  font-size:13px;
}
.keyDisplay {
  text-align:center;
  margin-top:6px;
  font-size:13px;
  color:#3fd2ff;
  word-break:break-all;
}

.adminFull {
  position:fixed;
  inset:0;
  background:#0b0e14;
  padding:20px;
  overflow:auto;
}

.keyRow {
  background:#111625;
  border-radius:10px;
  padding:12px;
  margin-bottom:12px;
  font-size:12px;
}

hr { opacity:.2 }
</style>
</head>

<body>

<!-- USER PANEL -->
<div id="userPanel" class="panel">
  <h2 style="text-align:center">ğŸ” RSQ Key System</h2>

  <input id="userid" placeholder="Roblox UserId">
  <button id="genBtn">Generate / Recover Key</button>

  <div id="status" class="status"></div>
  <div id="keyOut" class="keyDisplay"></div>

  <hr>

  <h3>ğŸ“¨ Appeal / Feedback</h3>
  <textarea id="feedbackText" placeholder="Explain your appeal or issue"></textarea>
  <button id="sendFeedback">Submit Appeal</button>
  <div id="feedbackStatus" class="status"></div>

  <hr>

  <button id="adminBtn" class="danger">ğŸ‘‘ Admin Panel</button>
  <input id="adminInput" class="hidden" placeholder="Admin Master Key">
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="adminFull hidden">
  <h2>ğŸ‘‘ ADMIN PANEL</h2>
  <button onclick="exitAdmin()">Exit Admin Panel</button>

  <hr>

  <h3>ğŸš« Ban UserId</h3>
  <input id="banUserId" placeholder="Roblox UserId">
  <select id="banDuration">
    <option value="3600">1 Hour</option>
    <option value="86400">1 Day</option>
    <option value="604800">1 Week</option>
    <option value="2592000">1 Month</option>
    <option value="31536000">1 Year</option>
  </select>
  <button class="danger" onclick="banUser()">Ban User (Deletes All Keys)</button>

  <hr>

  <h3>ğŸ”‘ Key Logs</h3>
  <div id="keyLogs"></div>

  <hr>

  <h3>ğŸ“œ Ban Logs</h3>
  <div id="banLogs"></div>

  <hr>

  <h3>ğŸ“¨ Feedback / Appeals</h3>
  <input id="searchFeedback" placeholder="Search by UserId">
  <div id="feedbackLogs"></div>
</div>

<script>
/* CONFIG */
const BIN_ID = "694c4aefae596e708faef157";
const JSONBIN_KEY = "$2a$10$DgQd.qgYLB2nv9e9ZFktKeUUkzZfmqPnL4Fk7JLvnN/ASlctW.8Cu";
const ADMIN_MASTER_KEY = "roblox";
const KEY_LIFE = 86400;
const DISCORD_WEBHOOK = "PUT_YOUR_WEBHOOK_URL_HERE";

/* HELPERS */
const now = () => Math.floor(Date.now()/1000);
const makeKey = () =>
  "RSQ-" + crypto.randomUUID().replace(/-/g,"").slice(0,24).toUpperCase();

function copy(text){
  navigator.clipboard.writeText(text);
}

/* JSONBIN */
async function getData(){
  const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`);
  return (await r.json()).record || {};
}
async function saveData(data){
  await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`,{
    method:"PUT",
    headers:{
      "Content-Type":"application/json",
      "X-Master-Key":JSONBIN_KEY
    },
    body:JSON.stringify(data)
  });
}

/* USER FLOW */
genBtn.onclick = async ()=>{
  const uid = userid.value.trim();
  status.textContent="";
  keyOut.textContent="";

  if(!/^\d+$/.test(uid)){
    status.textContent="âŒ Invalid UserId";
    return;
  }

  const data = await getData();
  data.keys ||= {};
  data.bans ||= {};

  if(data.bans[uid] && data.bans[uid] > now()){
    const msg = "ğŸš« You were banned by an admin. Appeal link copied.";
    status.textContent = msg;
    copy(location.href);
    return;
  }

  for(const k in data.keys){
    const d = data.keys[k];
    if(String(d.userId) === uid){
      status.textContent = d.expires===0
        ? "â™¾ï¸ Infinite key"
        : "âœ… Active key";
      keyOut.textContent = k;
      copy(k);
      return;
    }
  }

  const key = makeKey();
  data.keys[key] = { userId:Number(uid), expires: now()+KEY_LIFE };
  await saveData(data);

  status.textContent="âœ… Key generated & copied";
  keyOut.textContent=key;
  copy(key);
};

/* FEEDBACK / APPEAL */
sendFeedback.onclick = async ()=>{
  const uid = userid.value.trim();
  const text = feedbackText.value.trim();
  if(!uid || !text){
    feedbackStatus.textContent="âŒ Missing info";
    return;
  }

  const data = await getData();
  data.feedback ||= {};
  data.feedback[uid] ||= [];

  const last = data.feedback[uid].at(-1);
  if(last && now() - last.time < 60){
    feedbackStatus.textContent="â³ Please wait before sending again";
    return;
  }

  data.feedback[uid].push({ text, time:now() });
  await saveData(data);

  fetch(DISCORD_WEBHOOK,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      content:`ğŸ“¨ **New Appeal**\nUserId: ${uid}\nMessage: ${text}`
    })
  });

  feedbackStatus.textContent="âœ… Appeal sent";
  feedbackText.value="";
};

/* ADMIN LOGIN */
adminBtn.onclick = ()=>adminInput.classList.toggle("hidden");
adminInput.onchange = ()=>{
  if(adminInput.value !== ADMIN_MASTER_KEY){
    alert("Invalid admin key");
    return;
  }
  userPanel.classList.add("hidden");
  adminPanel.classList.remove("hidden");
  refreshAdmin();
};

async function refreshAdmin(){
  const data = await getData();
  renderKeys(data);
  renderBans(data);
  renderFeedback(data);
}

/* FEEDBACK ADMIN */
function renderFeedback(data){
  feedbackLogs.innerHTML="";
  data.feedback ||= {};
  const search = searchFeedback.value.trim();

  for(const uid in data.feedback){
    if(search && uid !== search) continue;
    data.feedback[uid].forEach((f,i)=>{
      const div=document.createElement("div");
      div.className="keyRow";
      div.innerHTML=`UserId: ${uid}<br>${f.text}<br>${new Date(f.time*1000).toLocaleString()}`;

      const del=document.createElement("button");
      del.textContent="Resolve / Delete";
      del.onclick=async()=>{
        data.feedback[uid].splice(i,1);
        if(!data.feedback[uid].length) delete data.feedback[uid];
        await saveData(data);
        refreshAdmin();
      };

      div.appendChild(del);
      feedbackLogs.appendChild(div);
    });
  }
}
searchFeedback.oninput=refreshAdmin;

/* EXISTING ADMIN FUNCTIONS (UNCHANGED) */
function renderKeys(data){ /* unchanged from your script */ }
function renderBans(data){ /* unchanged from your script */ }
async function banUser(){ /* unchanged from your script */ }
function exitAdmin(){
  adminPanel.classList.add("hidden");
  userPanel.classList.remove("hidden");
}
</script>
</body>
</html>
