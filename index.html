<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Key System Verification</title>

<style>
body {
  background:#0f0f0f;
  color:#fff;
  font-family:Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.box {
  background:#1b1b1b;
  padding:25px;
  border-radius:10px;
  width:380px;
}

h3 {
  margin:0 0 10px;
}

input, button {
  width:100%;
  padding:10px;
  margin-top:10px;
  border:none;
  border-radius:6px;
}

input {
  background:#111;
  color:white;
}

button {
  background:#0078ff;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

button:disabled {
  background:#333;
  cursor:not-allowed;
}

.output {
  margin-top:15px;
  background:#000;
  padding:10px;
  border-radius:6px;
  font-size:13px;
}
</style>
</head>
<body>

<div class="box">
  <h3>üîê Roblox Verification</h3>

  <input id="userid" placeholder="Roblox UserId">
  <button onclick="receiveUser()">Receive user from database</button>

  <button id="captchaBtn" disabled onclick="fakeCaptcha()">Verify CAPTCHA</button>
  <button id="genBtn" disabled onclick="generateKey()">Generate 24h Key</button>

  <div class="output" id="out">Waiting‚Ä¶</div>
</div>

<script>
/* ================= CONFIG ================= */

const OWNER = "RealScripts-q";
const REPO  = "KEY-JSONHandler";
const FILE  = "keys.json";

/* YES ‚Äî YOU WILL OBFUSCATE THIS LATER */
const GITHUB_TOKEN = "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";

/* ================= STATE ================= */

let cachedSha = null;
let cachedData = null;
let currentUserId = null;

/* ================= HELPERS ================= */

function log(msg){
  document.getElementById("out").innerText = msg;
}

function sleep(ms){
  return new Promise(r => setTimeout(r, ms));
}

function randomKey(){
  return "TV2-" + crypto.randomUUID().replace(/-/g,"").slice(0,20).toUpperCase();
}

/* ================= FETCH JSON ================= */

async function loadJSON(){
  const res = await fetch(
    `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE}`,
    { headers:{ Authorization:`token ${GITHUB_TOKEN}` } }
  );

  const data = await res.json();
  cachedSha = data.sha;
  cachedData = JSON.parse(atob(data.content));
}

/* ================= RECEIVE USER ================= */

async function receiveUser(){
  const userId = document.getElementById("userid").value.trim();
  if (!userId) return;

  currentUserId = userId;
  log("Checking database‚Ä¶");

  while (true) {
    await loadJSON();

    if (cachedData.users && cachedData.users[userId]) {
      log("User found. CAPTCHA required.");
      document.getElementById("captchaBtn").disabled = false;
      break;
    } else {
      log("Couldn't find player in database\nVerifying Roblox user‚Ä¶");
      await sleep(2500);
    }
  }
}

/* ================= FAKE CAPTCHA ================= */

async function fakeCaptcha(){
  log("Verifying CAPTCHA‚Ä¶");
  document.getElementById("captchaBtn").disabled = true;

  await sleep(2000);

  log("CAPTCHA passed ‚úî");
  document.getElementById("genBtn").disabled = false;
}

/* ================= GENERATE KEY ================= */

async function generateKey(){
  log("Generating 24h key‚Ä¶");

  const key = randomKey();
  const expires = Math.floor(Date.now()/1000) + 86400;

  cachedData.users[currentUserId].key = key;
  cachedData.users[currentUserId].expires = expires;

  await fetch(
    `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE}`,
    {
      method:"PUT",
      headers:{
        Authorization:`token ${GITHUB_TOKEN}`,
        "Content-Type":"application/json"
      },
      body:JSON.stringify({
        message:`Generate key for ${currentUserId}`,
        sha: cachedSha,
        content: btoa(JSON.stringify(cachedData, null, 2))
      })
    }
  );

  log("‚úÖ KEY GENERATED:\n" + key);
}
</script>

</body>
</html>
