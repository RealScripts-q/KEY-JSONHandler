<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RSQ Key System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#070707;
  font-family:system-ui;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card {
  width:480px;
  background:#121212;
  border-radius:18px;
  padding:20px;
  box-shadow:0 0 40px rgba(0,120,255,.25);
}
h1 { font-size:18px; margin:0; }
p { font-size:13px; color:#aaa; }

input,button {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:none;
}
input {
  background:#0b0b0b;
  color:#fff;
  border:1px solid #222;
}
button {
  background:linear-gradient(135deg,#007aff,#00c6ff);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}
button.secondary {
  background:linear-gradient(135deg,#ff6a00,#ff9500);
}
button.danger {
  background:linear-gradient(135deg,#ff3b30,#ff453a);
}
.hidden { display:none; }

.status { margin-top:10px; font-size:13px; }
.log {
  margin-top:10px;
  background:#0b0b0b;
  border:1px solid #222;
  border-radius:10px;
  padding:10px;
  max-height:260px;
  overflow:auto;
  font-family:monospace;
  white-space:pre-wrap;
}
.keyRow {
  border-bottom:1px solid #222;
  padding:8px 0;
}
.keyRow button {
  margin-top:6px;
}
</style>
</head>

<body>
<div class="card">
  <h1>ğŸ”‘ RSQ Key System</h1>
  <p>Normal users generate & renew keys Â· Admins manage everything</p>

  <!-- NORMAL PLAYER -->
  <input id="userid" placeholder="Roblox UserId">
  <button id="gen">Generate / Recover Key</button>

  <button id="browserBtn" class="secondary">
    ğŸŒ Get Key (Open Website)
  </button>

  <button id="renewBtn" class="secondary hidden">
    ğŸ”„ Renew Key (24h)
  </button>
  <input id="renewKey" class="hidden" placeholder="Paste renew key from Roblox">

  <!-- ADMIN -->
  <button id="adminBtn" class="danger">ğŸ‘‘ Admin Panel</button>
  <input id="adminKey" class="hidden" placeholder="Paste admin master key">

  <div id="status" class="status"></div>
  <div id="log" class="log hidden"></div>
</div>

<script>
/* ================= CONFIG ================= */
const BIN_ID = "694c4aefae596e708faef157";
const JSONBIN_MASTER_KEY = "$2a$10$DgQd.qgYLB2nv9e9ZFktKeUUkzZfmqPnL4Fk7JLvnN/ASlctW.8Cu";
const ADMIN_MASTER_KEY = "roblox";

const KEY_LIFE = 86400;

/* ================= HELPERS ================= */
const now = () => Math.floor(Date.now()/1000);
const makeKey = () => "RSQ-" + crypto.randomUUID().slice(0,8).toUpperCase();
const makeRenew = () => crypto.randomUUID().slice(0,6).toUpperCase();

/* ================= JSONBIN ================= */
async function getKeys() {
  const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`);
  return (await r.json()).record.keys || {};
}
async function saveKeys(keys) {
  await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
    method:"PUT",
    headers:{
      "Content-Type":"application/json",
      "X-Master-Key":JSONBIN_MASTER_KEY
    },
    body:JSON.stringify({ keys })
  });
}

/* ================= NORMAL PLAYER ================= */
gen.onclick = async () => {
  const uid = userid.value.trim();
  if (!/^\d+$/.test(uid))
    return status.textContent = "âŒ Invalid UserId";

  const keys = await getKeys();

  for (const k in keys) {
    const d = keys[k];
    if (d.userId == uid && d.expires > now()) {
      navigator.clipboard.writeText(k);
      status.textContent = "âœ… Active key copied";
      renewBtn.classList.remove("hidden");
      return;
    }
  }

  const key = makeKey();
  keys[key] = {
    userId:Number(uid),
    created:now(),
    expires:now()+KEY_LIFE,
    renewKey:makeRenew()
  };

  await saveKeys(keys);
  navigator.clipboard.writeText(key);
  status.textContent = "âœ… New key generated & copied";
  renewBtn.classList.remove("hidden");
};

browserBtn.onclick = () => {
  window.open("https://realscripts-q.github.io/KEY-JSONHandler/", "_blank");
};

/* ================= RENEW ================= */
renewBtn.onclick = () => {
  renewKey.classList.toggle("hidden");
  status.textContent = "Paste renew key from Roblox";
};

renewKey.onchange = async () => {
  const token = renewKey.value.trim().toUpperCase();
  const uid = userid.value.trim();
  if (!token || !uid) return;

  const keys = await getKeys();

  for (const k in keys) {
    const d = keys[k];
    if (d.userId == uid && d.expires > now() && d.renewKey === token) {
      d.expires = now() + KEY_LIFE;
      d.renewKey = makeRenew();
      await saveKeys(keys);
      status.textContent = "âœ… Key renewed to 24h";
      renewKey.value = "";
      renewKey.classList.add("hidden");
      return;
    }
  }

  status.textContent = "âŒ Invalid renew key or no active key";
};

/* ================= ADMIN ================= */
adminBtn.onclick = () => {
  adminKey.classList.toggle("hidden");
};

adminKey.onchange = async () => {
  if (adminKey.value !== ADMIN_MASTER_KEY) {
    status.textContent = "âŒ Invalid admin key";
    return;
  }

  const keys = await getKeys();
  log.innerHTML = "";
  log.classList.remove("hidden");
  status.textContent = "ğŸ‘‘ Admin access granted";

  for (const k in keys) {
    const d = keys[k];
    const div = document.createElement("div");
    div.className = "keyRow";
    div.innerHTML = `
      <b>${k}</b><br>
      UserId: ${d.userId}<br>
      Expires: ${new Date(d.expires*1000).toLocaleString()}
    `;

    const renew = document.createElement("button");
    renew.textContent = "Renew 24h";
    renew.onclick = async () => {
      d.expires = now() + KEY_LIFE;
      await saveKeys(keys);
      status.textContent = "Admin renewed key";
    };

    const del = document.createElement("button");
    del.textContent = "Delete Key";
    del.className = "danger";
    del.onclick = async () => {
      delete keys[k];
      await saveKeys(keys);
      div.remove();
      status.textContent = "Key deleted";
    };

    div.appendChild(renew);
    div.appendChild(del);
    log.appendChild(div);
  }
};
</script>
</body>
</html>
