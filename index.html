<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RSQ Key System</title>

<style>
body {
  margin:0;
  background:#0b0e14;
  font-family:system-ui;
  color:white;
}
.hidden{display:none}
.panel{
  width:520px;
  background:#141822;
  border-radius:18px;
  padding:22px;
  box-shadow:0 0 60px rgba(0,120,255,.3);
  margin:auto;
  margin-top:10vh;
}
button,input,select{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:8px;
  border:none;
}
input,select{
  background:#0b0f18;
  color:white;
  border:1px solid #222;
}
button{
  background:linear-gradient(135deg,#4f7cff,#3fd2ff);
  font-weight:bold;
  cursor:pointer;
}
button.danger{
  background:linear-gradient(135deg,#ff3b30,#ff453a);
}
button.secondary{
  background:linear-gradient(135deg,#ff8a00,#ffb300);
}
.status{text-align:center;margin-top:8px;font-size:13px}
.keyDisplay{text-align:center;color:#3fd2ff;word-break:break-all}
.adminFull{
  position:fixed;
  inset:0;
  background:#0b0e14;
  padding:20px;
  overflow:auto;
}
.keyRow{
  background:#111625;
  border-radius:10px;
  padding:12px;
  margin-bottom:12px;
  font-size:12px;
}
hr{opacity:.2}
</style>
</head>

<body>

<div id="userPanel" class="panel">
  <h2 style="text-align:center">ğŸ” RSQ Key System</h2>
  <input id="userid" placeholder="Roblox UserId">
  <button id="genBtn">Generate / Recover Key</button>
  <div id="status" class="status"></div>
  <div id="keyOut" class="keyDisplay"></div>
  <button id="adminBtn" class="danger">ğŸ‘‘ Admin Panel</button>
  <input id="adminInput" class="hidden" placeholder="Admin Master Key">
</div>

<div id="adminPanel" class="adminFull hidden">
  <h2>ğŸ‘‘ ADMIN PANEL</h2>
  <button onclick="exitAdmin()">Exit Admin Panel</button>
  <hr>
  <h3>ğŸš« Ban UserId</h3>
  <input id="banUserId" placeholder="Roblox UserId">
  <select id="banDuration">
    <option value="3600">1 Hour</option>
    <option value="86400">1 Day</option>
    <option value="604800">1 Week</option>
    <option value="2592000">1 Month</option>
    <option value="31536000">1 Year</option>
  </select>
  <button class="danger" onclick="banUser()">Ban User</button>
  <hr>
  <h3>ğŸ”‘ Key Logs</h3>
  <div id="keyLogs"></div>
  <hr>
  <h3>ğŸ“œ Ban Logs</h3>
  <div id="banLogs"></div>
</div>

<script>
/* CONFIG */
const BIN_ID="694c4aefae596e708faef157";
const JSONBIN_KEY="$2a$10$DgQd.qgYLB2nv9e9ZFktKeUUkzZfmqPnL4Fk7JLvnN/ASlctW.8Cu";
const ADMIN_MASTER_KEY="roblox";
const KEY_LIFE=86400;
const POLL_RATE=3000;

let CURRENT_UID=null;
let CURRENT_KEY=null;

/* HELPERS */
const now=()=>Math.floor(Date.now()/1000);
const makeKey=()=> "RSQ-"+crypto.randomUUID().replace(/-/g,"").slice(0,24).toUpperCase();
const copy=t=>navigator.clipboard.writeText(t);

/* JSONBIN */
async function getData(){
  const r=await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`);
  return (await r.json()).record||{};
}
async function saveData(data){
  await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`,{
    method:"PUT",
    headers:{
      "Content-Type":"application/json",
      "X-Master-Key":JSONBIN_KEY
    },
    body:JSON.stringify(data)
  });
}

/* USER ACTION */
genBtn.onclick=async()=>{
  const uid=userid.value.trim();
  if(!/^\d+$/.test(uid)){
    status.textContent="âŒ Invalid UserId";return;
  }
  CURRENT_UID=uid;
  localStorage.setItem("uid",uid);
  await syncUser();
};

/* LIVE USER SYNC */
async function syncUser(){
  if(!CURRENT_UID)return;
  const data=await getData();
  data.keys||={};
  data.bans||={};
  data.messages||={};

  if(data.bans[CURRENT_UID] && data.bans[CURRENT_UID]>now()){
    status.textContent="ğŸš« You were banned by an admin";
    keyOut.textContent="";
    return;
  }

  if(data.messages[CURRENT_UID]){
    status.textContent=data.messages[CURRENT_UID];
    delete data.messages[CURRENT_UID];
    await saveData(data);
  }

  for(const k in data.keys){
    const d=data.keys[k];
    if(d.userId==CURRENT_UID){
      CURRENT_KEY=k;
      if(d.expires===0){
        status.textContent="â™¾ï¸ Infinite key (admin)";
        keyOut.textContent=k;
        copy(k);
        return;
      }
      if(d.expires<now()){
        status.textContent="â° Key expired";
        keyOut.textContent="";
        return;
      }
      status.textContent="âœ… Active Â· Expires "+new Date(d.expires*1000).toLocaleString();
      keyOut.textContent=k;
      copy(k);
      return;
    }
  }

  const key=makeKey();
  data.keys[key]={userId:Number(CURRENT_UID),expires:now()+KEY_LIFE};
  await saveData(data);
}

/* ADMIN */
adminBtn.onclick=()=>adminInput.classList.toggle("hidden");
adminInput.onchange=()=>{
  if(adminInput.value!==ADMIN_MASTER_KEY)return alert("Invalid admin key");
  userPanel.classList.add("hidden");
  adminPanel.classList.remove("hidden");
  refreshAdmin();
};

async function refreshAdmin(){
  const data=await getData();
  renderKeys(data);
  renderBans(data);
}

/* KEYS */
async function renderKeys(data){
  keyLogs.innerHTML="";
  data.messages||={};

  for(const k in data.keys){
    const d=data.keys[k];
    const div=document.createElement("div");
    div.className="keyRow";
    div.innerHTML=`<b>${k}</b><br>UserId:${d.userId}<br>Expires:${d.expires===0?"Never":new Date(d.expires*1000)}`;
    const inf=document.createElement("button");
    inf.textContent="Make Infinite";
    inf.onclick=async()=>{
      d.expires=0;
      data.messages[d.userId]="ğŸ‘‘ Your key was made infinite by an admin";
      await saveData(data);refreshAdmin();
    };
    const del=document.createElement("button");
    del.textContent="Delete";
    del.className="danger";
    del.onclick=async()=>{
      delete data.keys[k];
      data.messages[d.userId]="ğŸ—‘ï¸ Your key was removed by an admin";
      await saveData(data);refreshAdmin();
    };
    div.append(inf,del);
    keyLogs.appendChild(div);
  }
}

/* BAN */
async function banUser(){
  const uid=banUserId.value.trim();
  if(!uid)return;
  const data=await getData();
  data.bans||={};
  data.messages||={};
  data.bans[uid]=now()+Number(banDuration.value);
  data.messages[uid]="ğŸš« You were banned by an admin";
  await saveData(data);
  refreshAdmin();
}

function renderBans(data){
  banLogs.innerHTML="";
  for(const u in data.bans){
    if(data.bans[u]<now())continue;
    const d=document.createElement("div");
    d.className="keyRow";
    d.innerHTML=`UserId:${u}<br>Until:${new Date(data.bans[u]*1000)}`;
    banLogs.appendChild(d);
  }
}

function exitAdmin(){
  adminPanel.classList.add("hidden");
  userPanel.classList.remove("hidden");
}

/* AUTO SYNC */
CURRENT_UID=localStorage.getItem("uid");
if(CURRENT_UID) syncUser();
setInterval(syncUser,POLL_RATE);
</script>
</body>
</html>
