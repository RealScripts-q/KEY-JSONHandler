<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tracker V2 â€“ Get Key</title>
<style>
body {
  background:#0f0f0f;
  color:#fff;
  font-family:Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.box {
  background:#1b1b1b;
  padding:25px;
  border-radius:10px;
  width:360px;
}
input, button {
  width:100%;
  padding:10px;
  margin-top:10px;
  border:none;
  border-radius:6px;
}
button {
  background:#0078ff;
  color:white;
  font-weight:bold;
  cursor:pointer;
}
.output {
  margin-top:15px;
  background:#000;
  padding:10px;
  border-radius:6px;
  word-break:break-all;
}
</style>
</head>
<body>

<div class="box">
  <h3>ðŸ”‘ Tracker V2 Key</h3>
  <input id="username" placeholder="Roblox Username">
  <button onclick="generate()">Get Key</button>
  <div class="output" id="out">Waitingâ€¦</div>
</div>

<script>
/* ================= CONFIG ================= */

// â¬‡â¬‡â¬‡ PASTE YOUR REAL TOKEN HERE â¬‡â¬‡â¬‡
const GITHUB_TOKEN = "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";

const OWNER = "RealScripts-q";
const REPO = "KEY-JSONHandler";
const FILE_PATH = "keys.json";

// 7 day expiry
const EXPIRY_SECONDS = 60 * 60 * 24 * 7;
const SECRET = "TrackerV2_Private_Salt";

/* ================= HASH ================= */

function hash(str) {
  let h = 0;
  for (let i = 0; i < str.length; i++) {
    h = (h << 5) - h + str.charCodeAt(i);
    h |= 0;
  }
  return Math.abs(h).toString(36).toUpperCase();
}

/* ================= MAIN ================= */

async function generate() {
  const username = document.getElementById("username").value.trim();
  const out = document.getElementById("out");

  if (!username) {
    out.innerText = "Enter a username";
    return;
  }

  out.innerText = "Resolving Roblox userâ€¦";

  /* Roblox username â†’ userId */
  const rbx = await fetch("https://users.roblox.com/v1/usernames/users", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ usernames: [username] })
  }).then(r => r.json());

  if (!rbx.data || !rbx.data[0]) {
    out.innerText = "User not found";
    return;
  }

  const userId = rbx.data[0].id;

  /* Generate key */
  const key = "TV2-" + hash(userId + ":" + SECRET);
  const expires = Math.floor(Date.now() / 1000) + EXPIRY_SECONDS;

  /* Fetch keys.json */
  const fileRes = await fetch(
    `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`,
    {
      headers: {
        Authorization: `Bearer ${GITHUB_TOKEN}`,
        Accept: "application/vnd.github+json"
      }
    }
  ).then(r => r.json());

  let data = {};
  if (fileRes.content) {
    data = JSON.parse(atob(fileRes.content));
  }

  /* Store key in loader-compatible format */
  data[key] = { expires };

  /* Write back to GitHub */
  await fetch(
    `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`,
    {
      method: "PUT",
      headers: {
        Authorization: `Bearer ${GITHUB_TOKEN}`,
        Accept: "application/vnd.github+json",
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: `Add key for ${username}`,
        content: btoa(JSON.stringify(data, null, 2)),
        sha: fileRes.sha
      })
    }
  );

  out.innerText = key;
}
</script>

</body>
</html>
