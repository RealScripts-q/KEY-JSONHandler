<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RSQ Elite | System Overseer</title>

<style>
:root {
    --primary: #4f7cff;
    --secondary: #00d2ff;
    --danger: #ff3b30;
    --success: #28cd41;
    --glass: rgba(15, 20, 30, 0.85);
    --border: rgba(255, 255, 255, 0.1);
}

body {
    margin: 0;
    background: #05070a;
    font-family: 'Segoe UI', system-ui, sans-serif;
    color: white;
    overflow: hidden;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Snowflake Animation */
.snowflake {
    color: #fff;
    font-size: 1em;
    position: fixed;
    top: -10%;
    z-index: 0;
    user-select: none;
    animation: fall linear infinite, shake ease-in-out infinite;
}
@keyframes fall { 0% { top: -10%; } 100% { top: 110%; } }
@keyframes shake { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(50px); } }

#bg-wrap { position: fixed; inset: 0; background: radial-gradient(circle at center, #0f172a 0%, #05070a 100%); z-index: -1; }

.panel {
    position: relative;
    z-index: 10;
    width: 450px;
    background: var(--glass);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 30px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
}

.hidden { display: none !important; }

input, textarea {
    width: 100%;
    box-sizing: border-box;
    padding: 12px;
    margin-top: 10px;
    background: rgba(0,0,0,0.4);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: white;
    outline: none;
}

button {
    width: 100%;
    padding: 12px;
    margin-top: 15px;
    border-radius: 10px;
    border: none;
    font-weight: 700;
    cursor: pointer;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    transition: 0.2s;
}
button:hover { transform: translateY(-2px); filter: brightness(1.2); }
button.danger { background: linear-gradient(135deg, #ff3b30, #ff7b30); }
button.mini { width: auto; padding: 5px 10px; font-size: 10px; margin: 2px; margin-top: 5px; }

/* Chat Box */
#chat-toggle {
    position: fixed; bottom: 25px; right: 25px; width: 55px; height: 55px;
    border-radius: 50%; background: var(--primary); display: flex;
    align-items: center; justify-content: center; cursor: pointer; z-index: 1000;
}

#chat-window {
    position: fixed; bottom: 90px; right: 25px; width: 320px; height: 450px;
    background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--border);
    border-radius: 15px; display: flex; flex-direction: column; z-index: 999; overflow: hidden;
}

#chat-msgs { flex: 1; overflow-y: auto; padding: 15px; font-size: 13px; }
.msg-item { margin-bottom: 10px; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px; position: relative; }
.msg-item b { color: var(--secondary); font-size: 10px; display: block; }
.del-msg { position: absolute; top: 5px; right: 8px; color: var(--danger); font-size: 9px; cursor: pointer; font-weight: bold; }

/* Bot Warning Style */
.bot-msg { border-left: 3px solid var(--danger); background: rgba(255, 59, 48, 0.1); }
.bot-name { color: var(--danger) !important; font-weight: bold; }

/* Admin Panel */
.adminFull {
    position: fixed; inset: 15px; background: #0b0f1a; border-radius: 20px;
    padding: 25px; z-index: 2000; overflow-y: auto; border: 1px solid var(--border);
}
.admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
.log-box { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; height: 400px; overflow-y: auto; border: 1px solid var(--border); }
</style>
</head>
<body>

<div id="bg-wrap"></div>

<div id="authPanel" class="panel">
    <h1 style="text-align:center; margin:0;">RSQ <span style="color:var(--secondary)">GATE</span></h1>
    <div id="loginView">
        <input id="l-user" placeholder="Username">
        <input id="l-pass" type="password" placeholder="Password">
        <button onclick="handleAuth('login')">Sign In</button>
        <p style="text-align:center; font-size:12px;">New? <a href="#" onclick="toggleAuth(true)" style="color:var(--secondary)">Create Account</a></p>
    </div>
    <div id="signupView" class="hidden">
        <input id="s-user" placeholder="Choose Username">
        <input id="s-pass" type="password" placeholder="Choose Password">
        <button onclick="handleAuth('signup')">Sign Up</button>
        <p style="text-align:center; font-size:12px;">Have account? <a href="#" onclick="toggleAuth(false)" style="color:var(--secondary)">Sign In</a></p>
    </div>
    <div id="authStatus" style="text-align:center; color:var(--danger); font-size:12px; margin-top:10px;"></div>
</div>

<div id="mainSystem" class="hidden">
    <div id="userPanel" class="panel">
        <h1 style="text-align:center; margin:0;">RSQ <span style="color:var(--secondary)">ELITE</span></h1>
        <p id="welcomeUser" style="text-align:center; opacity:0.5; font-size: 11px;"></p>
        
        <input id="userid" placeholder="Roblox UserID">
        <button id="genBtn">Generate Access Key</button>
        <div id="statusMsg" style="text-align:center; margin-top:10px; font-size:12px; color:var(--danger);"></div>
        <div id="keyOut" style="text-align:center; margin-top:10px; color:var(--secondary); font-family:monospace; font-weight:bold;"></div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:20px;">
            <button id="adminBtn" class="danger">Admin</button>
            <button style="background:none; border: 1px solid var(--border);" onclick="logout()">Logout</button>
        </div>
        <input id="adminInput" class="hidden" type="password" placeholder="Master Key">
    </div>

    <div id="chat-toggle">ðŸ’¬</div>
    <div id="chat-window" class="hidden">
        <div style="padding:10px; background:rgba(255,255,255,0.05); font-size:12px; font-weight:bold;">NETWORK CHAT</div>
        <div id="chat-msgs"></div>
        <div style="padding:10px; display:flex; gap:5px;">
            <input id="chatIn" placeholder="Message..." style="margin:0; font-size:12px;">
            <button id="sendChat" style="margin:0; width:50px;">âž”</button>
        </div>
    </div>
</div>

<div id="adminPanel" class="adminFull hidden">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>ðŸ‘‘ OVERSEER CONTROL</h2>
        <div style="display:flex; gap:10px;">
            <button onclick="nukeAll()" class="danger" style="width:auto; margin:0;">RESET ALL (NUKE)</button>
            <button onclick="document.getElementById('adminPanel').classList.add('hidden')" style="width:auto; margin:0; background:#444;">Exit</button>
        </div>
    </div>
    <input id="adminSearch" placeholder="Search Data..." style="margin-bottom:20px;" oninput="renderAdmin()">
    <div class="admin-grid">
        <div><h3>System Keys</h3><div id="keyLogs" class="log-box"></div></div>
        <div><h3>User Warns & Dev IDs</h3><div id="userLogs" class="log-box"></div></div>
    </div>
</div>

<script>
const BIN_ID = "694c4aefae596e708faef157";
const JSON_KEY = "$2a$10$DgQd.qgYLB2nv9e9ZFktKeUUkzZfmqPnL4Fk7JLvnN/ASlctW.8Cu";
const MASTER_KEY = "roblox";

const BANNED_WORDS = ["nigger", "fuck", "shit"];
let currentUser = null;
let currentWarns = 0;

const getDevId = () => btoa(navigator.userAgent + screen.width).slice(0, 12).toUpperCase();
const MY_ID = getDevId();
const now = () => Math.floor(Date.now()/1000);

async function api(method, data = null) {
    const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}${method==='GET'?'/latest':''}`, {
        method: method,
        headers: { "Content-Type": "application/json", "X-Master-Key": JSON_KEY },
        body: data ? JSON.stringify(data) : null
    });
    const res = await r.json();
    return res.record;
}

/* SNOW */
function initSnow() {
    for(let i=0; i<35; i++) {
        let s = document.createElement('div');
        s.className = 'snowflake'; s.innerHTML = 'â„';
        s.style.left = Math.random() * 100 + 'vw';
        s.style.animationDuration = (Math.random() * 3 + 5) + 's';
        document.body.appendChild(s);
    }
}
initSnow();

/* AUTH FLOW */
function toggleAuth(isSignup) {
    document.getElementById('signupView').classList.toggle('hidden', !isSignup);
    document.getElementById('loginView').classList.toggle('hidden', isSignup);
}

async function handleAuth(type) {
    const status = document.getElementById('authStatus');
    status.innerText = "Syncing...";
    const data = await api('GET');
    data.users ||= {};

    if(type === 'signup') {
        const u = document.getElementById('s-user').value.trim();
        const p = document.getElementById('s-pass').value.trim();
        if(!u || !p) return status.innerText = "Fields empty";
        if(data.users[u]) return status.innerText = "Username taken";
        if(Object.values(data.users).some(x => x.dev === MY_ID)) return status.innerText = "Device already linked";

        data.users[u] = { pass: p, dev: MY_ID, warns: 0 };
        await api('PUT', data);
        status.style.color = "var(--success)";
        status.innerText = "Created! Login now.";
        toggleAuth(false);
    } else {
        const u = document.getElementById('l-user').value.trim();
        const p = document.getElementById('l-pass').value.trim();
        if(data.users[u] && data.users[u].pass === p) {
            currentUser = u;
            currentWarns = data.users[u].warns || 0;
            document.getElementById('authPanel').classList.add('hidden');
            document.getElementById('mainSystem').classList.remove('hidden');
            document.getElementById('welcomeUser').innerText = `USER: ${u} | WARNS: ${currentWarns}`;
            startChatLoop();
        } else { status.innerText = "Invalid login"; }
    }
}

function logout() { location.reload(); }

/* KEY GEN FIX */
document.getElementById('genBtn').onclick = async () => {
    const rbxId = document.getElementById('userid').value.trim();
    if(!rbxId) {
        document.getElementById('statusMsg').innerText = "Enter a Roblox ID first!";
        return;
    }
    
    const status = document.getElementById('statusMsg');
    status.style.color = "var(--secondary)";
    status.innerText = "Searching Network...";
    
    const data = await api('GET');
    data.keys ||= {};

    // Check if THIS specific Roblox ID already has a key linked to THIS user
    const existing = Object.entries(data.keys).find(([k, v]) => v.rbx === rbxId && v.user === currentUser);
    
    if(existing) {
        status.innerText = "KEY RECOVERED";
        document.getElementById('keyOut').innerText = existing[0];
        return;
    }

    // Generate new key
    const newKey = "RSQ-" + Math.random().toString(36).substr(2, 9).toUpperCase();
    data.keys[newKey] = { 
        user: currentUser, 
        rbx: rbxId, 
        dev: MY_ID, 
        genDate: new Date().toLocaleDateString() 
    };

    await api('PUT', data);
    status.style.color = "var(--success)";
    status.innerText = "SUCCESS: KEY LINKED TO " + rbxId;
    document.getElementById('keyOut').innerText = newKey;
};

/* MODERATION BOT */
async function addWarning() {
    const data = await api('GET');
    data.users[currentUser].warns = (data.users[currentUser].warns || 0) + 1;
    currentWarns = data.users[currentUser].warns;
    await api('PUT', data);
    document.getElementById('welcomeUser').innerText = `USER: ${currentUser} | WARNS: ${currentWarns}`;
    botMessage("You have been warned. Any more warnings could result in a timeout.");
}

function botMessage(msg) {
    const box = document.getElementById('chat-msgs');
    const warning = document.createElement('div');
    warning.className = 'msg-item bot-msg';
    warning.innerHTML = `<b class="bot-name">[PRIVATE] RSQ MANAGER</b> ${msg}`;
    box.appendChild(warning);
    box.scrollTop = box.scrollHeight;
}

/* CHAT */
document.getElementById('chat-toggle').onclick = () => document.getElementById('chat-window').classList.toggle('hidden');

function startChatLoop() { setInterval(updateChat, 4000); updateChat(); }

async function updateChat() {
    const data = await api('GET');
    const box = document.getElementById('chat-msgs');
    const isAtBottom = box.scrollHeight - box.clientHeight <= box.scrollTop + 1;

    box.innerHTML = (data.chat || []).map((m, i) => `
        <div class="msg-item">
            <b>${m.user}</b>${m.txt}
            ${m.user === currentUser ? `<span class="del-msg" onclick="deleteMsg(${i})">DEL</span>` : ''}
        </div>
    `).join('');

    if (isAtBottom) box.scrollTop = box.scrollHeight;
}

document.getElementById('sendChat').onclick = async () => {
    const inp = document.getElementById('chatIn');
    const text = inp.value.trim();
    if(!text) return;

    if(currentWarns >= 2) {
        botMessage("you have been timeout for 5ms");
        inp.value = '';
        return;
    }

    if(BANNED_WORDS.some(word => text.toLowerCase().includes(word))) {
        const box = document.getElementById('chat-msgs');
        const localItem = document.createElement('div');
        localItem.className = 'msg-item';
        localItem.innerHTML = `<b>${currentUser}</b>${text}<span class="del-msg" onclick="this.parentElement.remove()">DEL</span>`;
        box.appendChild(localItem);
        box.scrollTop = box.scrollHeight;
        inp.value = '';
        await addWarning();
        return;
    }

    const data = await api('GET');
    data.chat ||= [];
    data.chat.push({ user: currentUser, txt: text });
    await api('PUT', data);
    inp.value = '';
    updateChat();
};

async function deleteMsg(idx) {
    const data = await api('GET');
    if(data.chat[idx] && data.chat[idx].user === currentUser) {
        data.chat.splice(idx, 1);
        await api('PUT', data);
        updateChat();
    }
}

/* ADMIN PANEL RENDER */
document.getElementById('adminBtn').onclick = () => document.getElementById('adminInput').classList.toggle('hidden');
document.getElementById('adminInput').onchange = function() {
    if(this.value === MASTER_KEY) {
        document.getElementById('adminPanel').classList.remove('hidden');
        renderAdmin();
    }
};

async function keyAction(act, k) {
    const data = await api('GET');
    if(act === 'del') delete data.keys[k];
    await api('PUT', data);
    renderAdmin();
}

async function renderAdmin() {
    const data = await api('GET');
    const term = document.getElementById('adminSearch').value.toUpperCase();
    
    document.getElementById('keyLogs').innerHTML = Object.entries(data.keys || {}).map(([k, v]) => {
        if(!k.includes(term) && !v.user.toUpperCase().includes(term)) return '';
        return `<div class="msg-item"><b>${k}</b> ID: ${v.rbx}<br>User: ${v.user}<br><button class="mini danger" onclick="keyAction('del','${k}')">Revoke</button></div>`;
    }).join('');

    document.getElementById('userLogs').innerHTML = Object.entries(data.users || {}).map(([u, v]) => {
        if(!u.toUpperCase().includes(term)) return '';
        return `<div class="msg-item"><b>${u}</b> Warns: ${v.warns || 0}<br>Dev: ${v.dev}</div>`;
    }).join('');
}

async function nukeAll() {
    if(!confirm("DELETE EVERYTHING?")) return;
    await api('PUT', { keys: {}, users: {}, chat: [], bans: [], registry: {} });
    location.reload();
}
</script>
</body>
</html>
