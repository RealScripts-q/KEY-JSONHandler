<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RSQ Key System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#070707;
  font-family:system-ui;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card {
  width:460px;
  background:#121212;
  border-radius:18px;
  padding:20px;
  box-shadow:0 0 40px rgba(0,120,255,.25);
}
h1 { font-size:18px; margin:0; }
p { font-size:13px; color:#aaa; }

input,button {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:none;
}
input {
  background:#0b0b0b;
  color:#fff;
  border:1px solid #222;
}
button {
  background:linear-gradient(135deg,#007aff,#00c6ff);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}
button.secondary {
  background:linear-gradient(135deg,#ff6a00,#ff9500);
}
button.danger {
  background:linear-gradient(135deg,#ff3b3b,#ff0000);
}

.hidden { display:none; }

.status { margin-top:10px; font-size:13px; }
.timer { margin-top:8px; font-size:13px; color:#00c6ff; }
.cooldown { margin-top:6px; font-size:12px; color:#ff9500; }

.admin {
  margin-top:14px;
  padding-top:10px;
  border-top:1px solid #222;
}
.log {
  background:#0b0b0b;
  padding:8px;
  border-radius:8px;
  font-size:12px;
  margin-top:6px;
}
</style>
</head>

<body>
<div class="card">

<h1>ğŸ”‘ RSQ Key System</h1>
<p>Normal users: enter UserId â€¢ Admins: use Master Key</p>

<!-- USER -->
<input id="userid" placeholder="Roblox UserId">
<button id="gen">Generate / Recover Key</button>

<!-- REQUEST ID -->
<input id="requestId" class="hidden" placeholder="Paste Request ID from Roblox">

<!-- RESET -->
<button id="renewBtn" class="secondary hidden">ğŸ”„ Force / Renew Key</button>
<input id="resetToken" class="hidden" placeholder="Paste Reset Token">

<!-- ADMIN -->
<div class="admin hidden" id="adminPanel">
  <h1>ğŸ‘‘ Admin Panel</h1>
  <input id="adminKey" placeholder="Paste Admin Master Key">
  <button id="adminLogin">Unlock Admin</button>

  <button id="refreshLogs" class="secondary hidden">ğŸ“œ Refresh Logs</button>
  <button id="genInf" class="secondary hidden">â™¾ Generate INF Key</button>

  <div id="logs"></div>
</div>

<div class="status" id="status"></div>
<div class="timer" id="timer"></div>
<div class="cooldown" id="cooldown"></div>

</div>

<script>
/* ================= CONFIG ================= */
const BIN_ID = "694c4aefae596e708faef157";
const JSONBIN_MASTER_KEY = "PUT_JSONBIN_MASTER_KEY_HERE"; // storage key
const ADMIN_MASTER_KEY = "RSQ-ADMIN-ONLY-KEY";            // your admin key

const KEY_LIFE = 86400;
const RESET_COOLDOWN = 21600;

/* ================= STATE ================= */
let keyInterval, cooldownInterval;
let isAdmin = false;

/* ================= HELPERS ================= */
const now = () => Math.floor(Date.now()/1000);
const makeKey = () => "RSQ-" + crypto.randomUUID().slice(0,8).toUpperCase();

function startKeyTimer(exp) {
  clearInterval(keyInterval);
  if (exp === "INF") {
    timer.textContent = "â™¾ Key expires: NEVER";
    return;
  }
  keyInterval = setInterval(() => {
    const r = exp - now();
    if (r <= 0) {
      timer.textContent = "â›” Key expired";
      clearInterval(keyInterval);
      return;
    }
    timer.textContent =
      `â± ${Math.floor(r/3600)}h ${Math.floor(r%3600/60)}m ${r%60}s`;
  }, 1000);
}

/* ================= JSONBIN ================= */
async function getKeys() {
  const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`);
  return (await r.json()).record.keys || {};
}

async function saveKeys(keys) {
  await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
    method:"PUT",
    headers:{
      "Content-Type":"application/json",
      "X-Master-Key": JSONBIN_MASTER_KEY
    },
    body:JSON.stringify({ keys })
  });
}

/* ================= USER FLOW ================= */
gen.onclick = async () => {
  const id = userid.value.trim();
  if (!/^\d+$/.test(id))
    return status.textContent = "âŒ Invalid UserId";

  const keys = await getKeys();
  for (const k in keys) {
    const d = keys[k];
    if (d.userId == id && (d.inf || d.expires > now())) {
      navigator.clipboard.writeText(k);
      status.textContent = "âœ… Existing key copied";
      startKeyTimer(d.inf ? "INF" : d.expires);
      renewBtn.classList.remove("hidden");
      return;
    }
  }

  const key = makeKey();
  keys[key] = {
    userId:Number(id),
    created:now(),
    expires:now()+KEY_LIFE,
    lastReset:0,
    resetToken:crypto.randomUUID().slice(0,6).toUpperCase()
  };

  await saveKeys(keys);
  navigator.clipboard.writeText(key);
  status.textContent = "âœ… New key generated & copied";
  startKeyTimer(keys[key].expires);
  renewBtn.classList.remove("hidden");
};

/* ================= RESET ================= */
renewBtn.onclick = () => {
  resetToken.classList.toggle("hidden");
  status.textContent = "ğŸ” Paste reset token from Roblox";
};

resetToken.onchange = async () => {
  const token = resetToken.value.trim().toUpperCase();
  const id = userid.value.trim();
  if (!token || !id) return;

  const keys = await getKeys();
  for (const k in keys) {
    const d = keys[k];
    if (d.userId == id && d.resetToken === token) {
      if (d.lastReset && now() - d.lastReset < RESET_COOLDOWN)
        return status.textContent = "â³ Reset cooldown active";

      delete keys[k];
      const nk = makeKey();
      keys[nk] = {
        userId:d.userId,
        created:now(),
        expires:now()+KEY_LIFE,
        lastReset:now(),
        resetToken:crypto.randomUUID().slice(0,6).toUpperCase()
      };

      await saveKeys(keys);
      navigator.clipboard.writeText(nk);
      status.textContent = "âœ… Key reset successfully";
      startKeyTimer(keys[nk].expires);
      resetToken.value="";
      resetToken.classList.add("hidden");
      return;
    }
  }
  status.textContent = "âŒ Invalid reset key";
};

/* ================= ADMIN ================= */
adminLogin.onclick = () => {
  if (adminKey.value !== ADMIN_MASTER_KEY)
    return status.textContent = "âŒ Invalid admin key";

  isAdmin = true;
  status.textContent = "ğŸ‘‘ Welcome Admin";
  refreshLogs.classList.remove("hidden");
  genInf.classList.remove("hidden");
};

refreshLogs.onclick = async () => {
  logs.innerHTML = "";
  const keys = await getKeys();
  for (const k in keys) {
    const d = keys[k];
    const div = document.createElement("div");
    div.className = "log";
    div.innerHTML =
      `<b>${k}</b><br>
       UID: ${d.userId}<br>
       Expires: ${d.inf ? "NEVER" : new Date(d.expires*1000).toLocaleString()}
       <br>
       <button onclick="adminRenew('${k}')">ğŸ”</button>
       <button onclick="adminDelete('${k}')" class="danger">ğŸ—‘</button>`;
    logs.appendChild(div);
  }
};

window.adminRenew = async (k) => {
  const keys = await getKeys();
  if (!keys[k]) return;
  keys[k].expires = now() + KEY_LIFE;
  await saveKeys(keys);
  refreshLogs.click();
};

window.adminDelete = async (k) => {
  const keys = await getKeys();
  delete keys[k];
  await saveKeys(keys);
  refreshLogs.click();
};

genInf.onclick = async () => {
  const id = userid.value.trim();
  if (!/^\d+$/.test(id)) return;

  const keys = await getKeys();
  const key = makeKey();
  keys[key] = {
    userId:Number(id),
    created:now(),
    inf:true
  };
  await saveKeys(keys);
  navigator.clipboard.writeText(key);
  status.textContent = "â™¾ INF key generated";
};
</script>
</body>
</html>
