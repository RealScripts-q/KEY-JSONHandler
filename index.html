<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RSQ Key System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#0b0e14;
  font-family:system-ui;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.panel {
  width:480px;
  background:#141822;
  border-radius:18px;
  padding:22px;
  box-shadow:0 0 50px rgba(0,120,255,.25);
}

h1 { text-align:center; margin:0 0 6px; }
p { text-align:center; font-size:13px; color:#aaa; }

input, button {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:none;
  font-size:14px;
}

input {
  background:#0b0f18;
  color:#fff;
  border:1px solid #222;
}

button {
  background:linear-gradient(135deg,#4f7cff,#3fd2ff);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

button.secondary {
  background:linear-gradient(135deg,#ff8a00,#ffb300);
}

button.danger {
  background:linear-gradient(135deg,#ff3b30,#ff453a);
}

.status {
  margin-top:10px;
  font-size:13px;
  text-align:center;
}

.status.ok { color:#00ff9c; }
.status.err { color:#ff5c5c; }
.status.warn { color:#ffb84d; }

.keybox {
  margin-top:10px;
  background:#0b0f18;
  padding:10px;
  border-radius:8px;
  font-size:12px;
  word-break:break-all;
  display:none;
}

.timer {
  margin-top:8px;
  text-align:center;
  font-size:14px;
}

.hidden { display:none; }

.adminPanel {
  margin-top:15px;
  background:#0b0f18;
  border-radius:12px;
  padding:10px;
  max-height:260px;
  overflow:auto;
  display:none;
}

.keyRow {
  border-bottom:1px solid #222;
  padding:8px 0;
  font-size:12px;
}
.keyRow button {
  margin-top:6px;
  width:100%;
}
</style>
</head>

<body>
<div class="panel">
  <h1>üîê RSQ Key System</h1>
  <p>Normal users generate keys ¬∑ Admins manage everything</p>

  <!-- NORMAL USER -->
  <input id="userid" placeholder="Roblox UserId">
  <button id="genBtn">Generate Key</button>

  <div id="keyBox" class="keybox"></div>
  <div id="status" class="status"></div>
  <div id="timer" class="timer"></div>

  <button class="secondary" id="checkBtn">Key Expire Time</button>
  <input id="checkKey" class="hidden" placeholder="Paste your key">

  <hr style="margin:18px 0;opacity:.2">

  <!-- ADMIN -->
  <button class="danger" id="adminBtn">üëë Admin Panel</button>
  <input id="adminInput" class="hidden" placeholder="Paste admin master key">

  <div id="adminPanel" class="adminPanel"></div>
</div>

<script>
/* ================= CONFIG ================= */
const BIN_ID = "694c4aefae596e708faef157";
const JSONBIN_KEY = "$2a$10$DgQd.qgYLB2nv9e9ZFktKeUUkzZfmqPnL4Fk7JLvnN/ASlctW.8Cu";
const ADMIN_MASTER_KEY = "roblox";
const KEY_LIFE = 86400;

/* ================= HELPERS ================= */
const now = () => Math.floor(Date.now()/1000);
const makeKey = () =>
  "RSQ-" + crypto.randomUUID().replace(/-/g,"").slice(0,20).toUpperCase();

function setStatus(msg,type="ok") {
  status.className = "status " + type;
  status.textContent = msg;
}

let timerInt;
function startTimer(exp) {
  clearInterval(timerInt);
  timerInt = setInterval(() => {
    const r = exp - now();
    if (r <= 0) {
      timer.textContent = "‚ùå EXPIRED";
      clearInterval(timerInt);
      return;
    }
    timer.textContent =
      `‚è± ${Math.floor(r/3600)}h ${Math.floor(r%3600/60)}m ${r%60}s`;
  }, 1000);
}

/* ================= JSONBIN ================= */
async function getKeys() {
  const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`);
  return (await r.json()).record.keys || {};
}

async function saveKeys(keys) {
  await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
    method:"PUT",
    headers:{
      "Content-Type":"application/json",
      "X-Master-Key":JSONBIN_KEY
    },
    body:JSON.stringify({ keys })
  });
}

/* ================= GENERATE KEY ================= */
genBtn.onclick = async () => {
  const uid = userid.value.trim();
  if (!/^\d+$/.test(uid)) {
    setStatus("‚ùå Invalid UserId","err");
    return;
  }

  const keys = await getKeys();

  for (const k in keys) {
    const d = keys[k];
    if (d.userId == uid && d.expires > now()) {
      navigator.clipboard.writeText(k);
      keyBox.style.display="block";
      keyBox.textContent = k;
      setStatus("‚úÖ Active key copied","ok");
      startTimer(d.expires);
      return;
    }
  }

  const key = makeKey();
  const exp = now()+KEY_LIFE;
  keys[key] = { userId:Number(uid), created:now(), expires:exp };

  await saveKeys(keys);
  navigator.clipboard.writeText(key);
  keyBox.style.display="block";
  keyBox.textContent = key;
  setStatus("‚úÖ New key generated","ok");
  startTimer(exp);
};

/* ================= CHECK KEY ================= */
checkBtn.onclick = () => checkKey.classList.toggle("hidden");

checkKey.oninput = async () => {
  const k = checkKey.value.trim();
  if (!k) return;
  const keys = await getKeys();
  const d = keys[k];

  if (!d) {
    setStatus("‚ùå Invalid key","err");
    timer.textContent="";
    return;
  }
  if (d.expires <= now()) {
    setStatus("‚ö†Ô∏è Key expired","warn");
    timer.textContent="‚ùå EXPIRED";
    return;
  }
  setStatus("‚úÖ Key valid","ok");
  startTimer(d.expires);
};

/* ================= ADMIN ================= */
adminBtn.onclick = () => adminInput.classList.toggle("hidden");

adminInput.onchange = async () => {
  if (adminInput.value !== ADMIN_MASTER_KEY) {
    setStatus("‚ùå Invalid admin key","err");
    return;
  }

  setStatus("üëë Admin access granted","ok");
  adminPanel.style.display="block";
  adminPanel.innerHTML="";
  const keys = await getKeys();

  for (const k in keys) {
    const d = keys[k];
    const div = document.createElement("div");
    div.className="keyRow";
    div.innerHTML = `
<b>${k}</b><br>
UserId: ${d.userId}<br>
Expires: ${d.expires <= now() ? "EXPIRED" : new Date(d.expires*1000).toLocaleString()}
    `;

    const renew = document.createElement("button");
    renew.textContent="Renew 24h";
    renew.onclick = async ()=>{
      d.expires = now()+KEY_LIFE;
      await saveKeys(keys);
      setStatus("Key renewed","ok");
    };

    const del = document.createElement("button");
    del.textContent="Delete key";
    del.className="danger";
    del.onclick = async ()=>{
      delete keys[k];
      await saveKeys(keys);
      div.remove();
      setStatus("Key deleted","warn");
    };

    div.appendChild(renew);
    div.appendChild(del);
    adminPanel.appendChild(div);
  }
};
</script>
</body>
</html>
