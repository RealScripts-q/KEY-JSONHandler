<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RSQ Elite | System Overseer</title>

<style>
:root {
    --primary: #4f7cff;
    --secondary: #00d2ff;
    --danger: #ff3b30;
    --success: #28cd41;
    --warning: #ffcc00;
    --glass: rgba(15, 20, 30, 0.85);
    --border: rgba(255, 255, 255, 0.1);
}

body {
    margin: 0;
    background: #05070a;
    font-family: 'Segoe UI', system-ui, sans-serif;
    color: white;
    overflow: hidden;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Animations */
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-10px); } }
@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
@keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(79, 124, 255, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(79, 124, 255, 0); } 100% { box-shadow: 0 0 0 0 rgba(79, 124, 255, 0); } }

.animate-fade { animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
.animate-shake { animation: shake 0.2s ease-in-out 0s 2; }

#bg-wrap { position: fixed; inset: 0; background: radial-gradient(circle at center, #0f172a 0%, #05070a 100%); z-index: -1; }

.panel {
    position: relative;
    z-index: 10;
    width: 450px;
    background: var(--glass);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 30px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
}

.hidden { display: none !important; }

input, select {
    width: 100%;
    box-sizing: border-box;
    padding: 12px;
    margin-top: 10px;
    background: rgba(0,0,0,0.4);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: white;
    outline: none;
}

button {
    width: 100%;
    padding: 12px;
    margin-top: 15px;
    border-radius: 10px;
    border: none;
    font-weight: 700;
    cursor: pointer;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    transition: 0.3s;
}

button:hover { transform: scale(1.02); filter: brightness(1.2); }
button.danger { background: linear-gradient(135deg, #ff3b30, #ff7b30); }
button.warning { background: linear-gradient(135deg, #ffcc00, #ffae00); color: #000; }
button.mini { padding: 4px 8px; font-size: 10px; margin-top: 5px; width: auto; }

/* Chat Toggle Redesign */
#chat-toggle {
    position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px;
    border-radius: 50%; background: white; display: flex;
    align-items: center; justify-content: center; cursor: pointer; z-index: 1000;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    border: 3px solid var(--primary);
    transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
#chat-toggle svg { width: 30px; height: 30px; fill: var(--primary); }

#chat-window {
    position: fixed; bottom: 100px; right: 25px; width: 340px; height: 500px;
    background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--border);
    border-radius: 15px; display: flex; flex-direction: column; z-index: 999; overflow: hidden;
    transform-origin: bottom right; transition: 0.3s ease;
}

#chat-msgs { flex: 1; overflow-y: auto; padding: 15px; font-size: 13px; scroll-behavior: smooth;}
#pinned-area { background: rgba(255, 204, 0, 0.1); border-bottom: 1px solid var(--warning); padding: 10px; font-size: 12px; }

.msg-item { 
    margin-bottom: 10px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; 
    animation: fadeIn 0.3s forwards; position: relative; border-left: 2px solid transparent;
}
.msg-item.system { border-left-color: var(--primary); background: rgba(79, 124, 255, 0.1); animation: fadeIn 0.3s forwards, pulse 2s infinite; }
.msg-item b { color: var(--secondary); font-size: 11px; display: block; margin-bottom: 3px;}
.del-btn { 
    position: absolute; top: 8px; right: 8px; color: var(--danger); 
    cursor: pointer; font-weight: 800; font-size: 10px; background: rgba(255,0,0,0.1);
    padding: 2px 5px; border-radius: 4px; transition: 0.2s;
}
.del-btn:hover { background: var(--danger); color: white; }

.timeout-overlay {
    background: rgba(255, 59, 48, 0.1);
    padding: 10px;
    text-align: center;
    font-size: 11px;
    color: var(--danger);
    font-weight: bold;
}

/* Admin Full View */
.adminFull {
    position: fixed; inset: 15px; background: #0b0f1a; border-radius: 20px;
    padding: 25px; z-index: 2000; overflow-y: auto; border: 1px solid var(--border);
}
.log-box { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; height: 350px; overflow-y: auto; }
</style>
</head>
<body>

<div id="bg-wrap"></div>

<div id="authPanel" class="panel animate-fade">
    <h1 style="text-align:center; margin:0;">RSQ <span style="color:var(--secondary)">GATE</span></h1>
    <div id="loginView">
        <input id="l-user" placeholder="Username">
        <input id="l-pass" type="password" placeholder="Password">
        <button onclick="handleAuth('login')">Sign In</button>
        <p style="text-align:center; font-size:12px;">New? <a href="#" onclick="toggleAuth(true)" style="color:var(--secondary)">Create Account</a></p>
    </div>
    <div id="signupView" class="hidden">
        <input id="s-user" placeholder="Choose Username">
        <input id="s-pass" type="password" placeholder="Choose Password">
        <button onclick="handleAuth('signup')">Sign Up</button>
        <p style="text-align:center; font-size:12px;">Have account? <a href="#" onclick="toggleAuth(false)" style="color:var(--secondary)">Sign In</a></p>
    </div>
    <div id="authStatus" style="text-align:center; color:var(--danger); font-size:12px; margin-top:10px;"></div>
</div>

<div id="mainSystem" class="hidden">
    <div id="userPanel" class="panel animate-fade">
        <h1 style="text-align:center; margin:0;">RSQ <span style="color:var(--secondary)">ELITE</span></h1>
        <p id="welcomeUser" style="text-align:center; opacity:0.5; font-size: 11px;"></p>
        
        <input id="userid" placeholder="Roblox UserID">
        <button id="genBtn">Generate Access Key</button>
        <div id="statusMsg" style="text-align:center; margin-top:10px; font-size:12px; color:var(--danger);"></div>
        <div id="keyOut" style="text-align:center; margin-top:10px; color:var(--secondary); font-family:monospace; font-weight:bold;"></div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:20px;">
            <button id="adminBtn" class="danger hidden">Admin</button>
            <button style="background:none; border: 1px solid var(--border);" onclick="logout()">Logout</button>
        </div>
        <input id="adminInput" class="hidden" type="password" placeholder="Master Key">
    </div>

    <div id="chat-toggle" onclick="toggleChat()">
        <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
    </div>
    <div id="chat-window" class="hidden">
        <div style="padding:10px; background:rgba(255,255,255,0.05); font-size:12px; font-weight:bold;">NETWORK CHAT</div>
        <div id="pinned-area" class="hidden"></div>
        <div id="chat-msgs"></div>
        
        <div id="chat-controls" style="padding:10px; display:flex; gap:5px; background: rgba(0,0,0,0.2);">
            <input id="chatIn" placeholder="Message..." style="margin:0; font-size:12px;">
            <button id="sendChat" style="margin:0; width:50px;">âž”</button>
        </div>
        <div id="timeout-msg" class="timeout-overlay hidden"></div>
    </div>
</div>

<div id="adminPanel" class="adminFull hidden">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>ðŸ‘‘ OVERSEER CONTROL</h2>
        <button onclick="closeAdmin()" style="width:auto; margin:0; background:#444;">Exit</button>
    </div>

    <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:15px; margin-top:20px;">
        <h3 style="margin-top:0">ðŸ”¨ Ban & Global Messaging</h3>
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
            <input id="banUserId" placeholder="Target Roblox ID">
            <div style="display:flex; gap:5px;">
                <input id="banTime" type="number" placeholder="Value" style="width:60px">
                <select id="banUnit" style="width:auto">
                    <option value="3600">Hours</option>
                    <option value="86400">Days</option>
                    <option value="604800">Weeks</option>
                </select>
            </div>
            <input id="banReason" placeholder="Reason / Broadcast Text">
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:10px;">
            <button onclick="processBan()">BAN USER</button>
            <button class="warning" onclick="sendGlobalMsg(true)">PIN LIVE</button>
            <button class="warning" onclick="sendGlobalMsg(false)">ANNOUNCE</button>
            <button class="danger" onclick="clearGlobals()">PURGE GLOBALS</button>
        </div>
    </div>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-top:20px;">
        <div><h3>Active Bans</h3><div id="banLogs" class="log-box"></div></div>
        <div><h3>System Keys</h3><div id="keyLogs" class="log-box"></div></div>
    </div>
</div>

<script>
const BIN_ID = "694c4aefae596e708faef157";
const JSON_KEY = "$2a$10$DgQd.qgYLB2nv9e9ZFktKeUUkzZfmqPnL4Fk7JLvnN/ASlctW.8Cu";
const MASTER_KEY = "roblox";
const SUPER_ADMIN = "Plstealme2";

// AUTO-MOD CONFIG
const BAD_WORDS = ["slur1", "slur2", "slur3"]; // Add prohibited words here
const TIMEOUT_DURATION = 600; // 10 minutes in seconds
const WARN_RESET_TIME = 86400; // 24 hours in seconds

let currentUser = null;
let isAdminAuthenticated = false;

const now = () => Math.floor(Date.now()/1000);

async function api(method, data = null) {
    const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}${method==='GET'?'/latest':''}`, {
        method: method,
        headers: { "Content-Type": "application/json", "X-Master-Key": JSON_KEY },
        body: data ? JSON.stringify(data) : null
    });
    const res = await r.json();
    return res.record;
}

function triggerShake(id) {
    const el = document.getElementById(id);
    el.classList.remove('animate-shake');
    void el.offsetWidth;
    el.classList.add('animate-shake');
}

function toggleAuth(isSignup) {
    document.getElementById('authPanel').style.opacity = '0';
    setTimeout(() => {
        document.getElementById('signupView').classList.toggle('hidden', !isSignup);
        document.getElementById('loginView').classList.toggle('hidden', isSignup);
        document.getElementById('authPanel').style.opacity = '1';
    }, 200);
}

function toggleChat() { document.getElementById('chat-window').classList.toggle('hidden'); }

async function handleAuth(type) {
    const status = document.getElementById('authStatus');
    status.innerText = "Connecting...";
    const data = await api('GET');
    data.users ||= {};

    const u = document.getElementById(type === 'signup' ? 's-user' : 'l-user').value.trim();
    const p = document.getElementById(type === 'signup' ? 's-pass' : 'l-pass').value.trim();

    if(!u || !p) { triggerShake('authPanel'); return status.innerText = "Empty fields"; }

    if(type === 'signup') {
        if(data.users[u]) return status.innerText = "User exists";
        data.users[u] = { pass: p, dev: "N/A", warns: 0, lastWarn: 0, timeoutUntil: 0 };
        await api('PUT', data);
        status.innerText = "Success! Login now.";
        toggleAuth(false);
    } else {
        if(data.users[u] && data.users[u].pass === p) {
            currentUser = u;
            if(u === SUPER_ADMIN) document.getElementById('adminBtn').classList.remove('hidden');
            
            document.getElementById('authPanel').style.animation = "fadeOut 0.4s forwards";
            setTimeout(() => {
                document.getElementById('authPanel').classList.add('hidden');
                document.getElementById('mainSystem').classList.remove('hidden');
                document.getElementById('welcomeUser').innerText = `SESSION: ${u}`;
                startChatLoop();
            }, 400);
        } else {
            triggerShake('authPanel');
            status.innerText = "Access Denied";
        }
    }
}

async function sendChat() {
    const input = document.getElementById('chatIn');
    let txt = input.value.trim();
    if(!txt) return;

    const data = await api('GET');
    const userProfile = data.users[currentUser];

    // Check Timeout
    if(userProfile.timeoutUntil > now()) return;

    // Warning Reset Logic (24 hours)
    if(userProfile.warns > 0 && (now() - userProfile.lastWarn) > WARN_RESET_TIME) {
        userProfile.warns = 0;
    }

    // Slur Detection
    const hasSlur = BAD_WORDS.some(word => txt.toLowerCase().includes(word));
    
    if(hasSlur) {
        userProfile.warns++;
        userProfile.lastWarn = now();
        input.value = "";

        if(userProfile.warns > 1) {
            userProfile.timeoutUntil = now() + TIMEOUT_DURATION;
            data.chat.push({ user: "SYSTEM", txt: `${currentUser} has been TIMED OUT for repeated violations.` });
        } else {
            data.chat.push({ user: "SYSTEM", txt: `WARNING for ${currentUser}: Prohibited language detected.` });
        }
        
        await api('PUT', data);
        updateChat();
        return;
    }

    data.chat ||= [];
    data.chat.push({ user: currentUser, txt: txt });
    await api('PUT', data);
    input.value = "";
    updateChat();
}

async function updateChat() {
    const data = await api('GET');
    const box = document.getElementById('chat-msgs');
    const pin = document.getElementById('pinned-area');
    const controls = document.getElementById('chat-controls');
    const timeoutBox = document.getElementById('timeout-msg');

    // Handle Local Timeout UI
    const userProfile = data.users[currentUser];
    if(userProfile && userProfile.timeoutUntil > now()) {
        const remaining = userProfile.timeoutUntil - now();
        const mins = Math.floor(remaining / 60);
        const secs = remaining % 60;
        controls.classList.add('hidden');
        timeoutBox.classList.remove('hidden');
        timeoutBox.innerText = `YOU ARE TIMED OUT: WAIT ${mins}m ${secs}s`;
    } else {
        controls.classList.remove('hidden');
        timeoutBox.classList.add('hidden');
    }

    if(data.pinnedMsg) {
        pin.classList.remove('hidden');
        pin.innerHTML = `<span class="pin-tag">LIVE:</span> ${data.pinnedMsg.txt}`;
    } else pin.classList.add('hidden');

    box.innerHTML = (data.chat || []).map((m, i) => `
        <div class="msg-item ${m.user === 'SYSTEM' ? 'system' : ''}">
            <b>${m.user}</b> ${m.txt}
            ${currentUser === SUPER_ADMIN ? `<span class="del-btn" onclick="deleteMsg(${i})">DEL</span>` : ''}
        </div>
    `).join('');
    box.scrollTop = box.scrollHeight;
}

// Tick every second for the timeout timer UI
function startChatLoop() { 
    setInterval(updateChat, 3000); // Server sync
    setInterval(() => {
        // Fast UI update for the countdown timer
        const timeoutBox = document.getElementById('timeout-msg');
        if(!timeoutBox.classList.contains('hidden')) updateChat();
    }, 1000); 
    updateChat(); 
}

document.getElementById('sendChat').onclick = sendChat;
document.getElementById('chatIn').addEventListener("keypress", (e) => { if(e.key === "Enter") sendChat(); });

/* Admin Logic */
document.getElementById('adminBtn').onclick = () => {
    if(isAdminAuthenticated) {
        document.getElementById('adminPanel').classList.remove('hidden');
        renderAdmin();
    } else {
        document.getElementById('adminInput').classList.toggle('hidden');
    }
};

document.getElementById('adminInput').onchange = function() {
    if(this.value === MASTER_KEY) {
        isAdminAuthenticated = true;
        this.classList.add('hidden');
        document.getElementById('adminPanel').classList.remove('hidden');
        renderAdmin();
    } else {
        triggerShake('userPanel');
        this.value = "";
    }
};

function closeAdmin() { document.getElementById('adminPanel').classList.add('hidden'); }

async function deleteMsg(index) {
    const data = await api('GET');
    data.chat.splice(index, 1);
    await api('PUT', data);
    updateChat();
}

async function processBan() {
    const id = document.getElementById('banUserId').value;
    const time = document.getElementById('banTime').value;
    const unit = document.getElementById('banUnit').value;
    const reason = document.getElementById('banReason').value;
    if(!id || !time) return alert("Fill ID and Time");
    const data = await api('GET');
    data.bans ||= {};
    data.bans[id] = { reason: reason || "Violation", exp: now() + (time * unit) };
    await api('PUT', data);
    alert("User Restricted");
    renderAdmin();
}

async function sendGlobalMsg(isPinned) {
    const txt = document.getElementById('banReason').value;
    if(!txt) return alert("Enter text");
    const data = await api('GET');
    data.chat ||= [];
    const msg = { user: "SYSTEM", txt: txt.toUpperCase() };
    if(isPinned) data.pinnedMsg = msg;
    data.chat.push(msg);
    await api('PUT', data);
    updateChat();
}

async function clearGlobals() {
    const data = await api('GET');
    data.pinnedMsg = null;
    data.chat = data.chat.filter(m => m.user !== 'SYSTEM');
    await api('PUT', data);
    updateChat();
}

async function renderAdmin() {
    const data = await api('GET');
    document.getElementById('banLogs').innerHTML = Object.entries(data.bans || {}).map(([id, v]) => `
        <div class="msg-item">
            <b>ROBLOX ID: ${id}</b> ${v.reason}
            <button class="mini danger" onclick="unban('${id}')">UNBAN</button>
        </div>
    `).join('');
}

async function unban(id) {
    const data = await api('GET');
    delete data.bans[id];
    await api('PUT', data);
    renderAdmin();
}

function logout() { location.reload(); }
</script>
</body>
</html>
