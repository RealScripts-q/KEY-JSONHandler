<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RSQ Elite | System Overseer</title>

<style>
:root {
    --primary: #4f7cff;
    --secondary: #00d2ff;
    --danger: #ff3b30;
    --success: #28cd41;
    --glass: rgba(15, 20, 30, 0.85);
    --border: rgba(255, 255, 255, 0.1);
}

body {
    margin: 0;
    background: #05070a;
    font-family: 'Segoe UI', system-ui, sans-serif;
    color: white;
    overflow: hidden;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Snowflake Animation */
.snowflake {
    color: #fff;
    font-size: 1em;
    position: fixed;
    top: -10%;
    z-index: 0;
    user-select: none;
    animation: fall linear infinite, shake ease-in-out infinite;
}
@keyframes fall { 0% { top: -10%; } 100% { top: 110%; } }
@keyframes shake { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(50px); } }

#bg-wrap { position: fixed; inset: 0; background: radial-gradient(circle at center, #0f172a 0%, #05070a 100%); z-index: -1; }

.panel {
    position: relative;
    z-index: 10;
    width: 450px;
    background: var(--glass);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 30px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
}

.hidden { display: none !important; }

input, textarea {
    width: 100%;
    box-sizing: border-box;
    padding: 12px;
    margin-top: 10px;
    background: rgba(0,0,0,0.4);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: white;
    outline: none;
}

button {
    width: 100%;
    padding: 12px;
    margin-top: 15px;
    border-radius: 10px;
    border: none;
    font-weight: 700;
    cursor: pointer;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    transition: 0.2s;
}
button:hover { transform: translateY(-2px); filter: brightness(1.2); }
button.danger { background: linear-gradient(135deg, #ff3b30, #ff7b30); }
button.mini { width: auto; padding: 5px 10px; font-size: 10px; margin: 2px; margin-top: 5px; }

/* Chat Box */
#chat-toggle {
    position: fixed;
    bottom: 25px;
    right: 25px;
    width: 55px;
    height: 55px;
    border-radius: 50%;
    background: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 1000;
}

#chat-window {
    position: fixed;
    bottom: 90px;
    right: 25px;
    width: 320px;
    height: 400px;
    background: var(--glass);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border);
    border-radius: 15px;
    display: flex;
    flex-direction: column;
    z-index: 999;
    overflow: hidden;
}

#chat-msgs { flex: 1; overflow-y: auto; padding: 15px; font-size: 13px; }
.msg-item { margin-bottom: 10px; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px; }
.msg-item b { color: var(--secondary); font-size: 10px; display: block; }

/* Admin Panel */
.adminFull {
    position: fixed;
    inset: 15px;
    background: #0b0f1a;
    border-radius: 20px;
    padding: 25px;
    z-index: 2000;
    overflow-y: auto;
    border: 1px solid var(--border);
}

.admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
.log-box { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; height: 400px; overflow-y: auto; border: 1px solid var(--border); }

.search-bar { margin-bottom: 15px; }
</style>
</head>
<body>

<div id="bg-wrap"></div>

<div id="userPanel" class="panel">
    <h1 style="text-align:center; margin:0;">RSQ <span style="color:var(--secondary)">ELITE</span></h1>
    <p style="text-align:center; opacity:0.5; font-size: 11px; letter-spacing: 1px;">HARDWARE AUTHENTICATION</p>
    
    <input id="userid" placeholder="Roblox UserID">
    <button id="genBtn">Generate Access Key</button>
    <div id="statusMsg" style="text-align:center; margin-top:10px; font-size:12px; color:var(--danger);"></div>
    <div id="keyOut" style="text-align:center; margin-top:10px; color:var(--secondary); font-family:monospace; font-weight:bold;"></div>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:20px;">
        <button id="adminBtn" class="danger">Admin</button>
        <button style="background:none; border: 1px solid var(--border);" onclick="toggleFeedback()">Feedback</button>
    </div>
    <input id="adminInput" class="hidden" type="password" placeholder="Master Key">
</div>

<div id="feedbackPanel" class="panel hidden">
    <h2 style="text-align:center">Feedback</h2>
    <textarea id="feedMsg" placeholder="Report a bug or suggest a feature..." style="height:100px;"></textarea>
    <button onclick="sendFeedback()">Submit</button>
    <button onclick="toggleFeedback()" style="background:none;">Close</button>
</div>

<div id="chat-toggle">ðŸ’¬</div>
<div id="chat-window" class="hidden">
    <div style="padding:10px; background:rgba(255,255,255,0.05); font-size:12px; font-weight:bold;">NETWORK CHAT</div>
    <div id="chat-msgs"></div>
    <div style="padding:10px; display:flex; gap:5px;">
        <input id="chatIn" placeholder="Message..." style="margin:0; font-size:12px;">
        <button id="sendChat" style="margin:0; width:50px;">âž”</button>
    </div>
</div>

<div id="adminPanel" class="adminFull hidden">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>ðŸ‘‘ OVERSEER CONTROL</h2>
        <div style="display:flex; gap:10px;">
            <button onclick="nukeAll()" class="danger" style="width:auto; margin:0; background:linear-gradient(to right, #ff3b30, #7b0000);">RESET ALL (NUKE)</button>
            <button onclick="manualBan()" class="danger" style="width:auto; margin:0; background:orange;">BAN USER</button>
            <button onclick="location.reload()" style="width:auto; margin:0; background:#444;">Exit</button>
        </div>
    </div>

    <div class="search-bar">
        <input id="adminSearch" placeholder="Search by Device, UserID, or Key..." oninput="filterAdmin()">
    </div>

    <div class="admin-grid">
        <div>
            <h3>Active Keys & Management</h3>
            <div id="keyLogs" class="log-box"></div>
        </div>
        <div>
            <h3>User Feedback & Bans</h3>
            <div id="feedLogs" class="log-box"></div>
            <div id="banDisplay" style="margin-top:10px; font-size:12px; color:var(--danger);"></div>
        </div>
    </div>
</div>

<script>
/* CONFIG */
const BIN_ID = "694c4aefae596e708faef157";
const JSON_KEY = "$2a$10$DgQd.qgYLB2nv9e9ZFktKeUUkzZfmqPnL4Fk7JLvnN/ASlctW.8Cu";
const MASTER_KEY = "roblox";

/* HELPERS */
const getDevId = () => btoa(navigator.userAgent + screen.width).slice(0, 12).toUpperCase();
const MY_ID = getDevId();
const now = () => Math.floor(Date.now()/1000);

async function api(method, data = null) {
    const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}${method==='GET'?'/latest':''}`, {
        method: method,
        headers: { "Content-Type": "application/json", "X-Master-Key": JSON_KEY },
        body: data ? JSON.stringify(data) : null
    });
    const res = await r.json();
    return res.record;
}

/* SNOW */
function initSnow() {
    for(let i=0; i<40; i++) {
        let s = document.createElement('div');
        s.className = 'snowflake';
        s.innerHTML = 'â„';
        s.style.left = Math.random() * 100 + 'vw';
        s.style.animationDuration = (Math.random() * 3 + 5) + 's';
        s.style.animationDelay = Math.random() * 5 + 's';
        s.style.opacity = Math.random();
        document.body.appendChild(s);
    }
}
initSnow();

/* CHAT */
document.getElementById('chat-toggle').onclick = () => document.getElementById('chat-window').classList.toggle('hidden');

async function updateChat() {
    const data = await api('GET');
    const box = document.getElementById('chat-msgs');
    box.innerHTML = (data.chat || []).map(m => `<div class="msg-item"><b>DEV-${m.dev}</b>${m.txt}</div>`).join('');
    box.scrollTop = box.scrollHeight;
}

document.getElementById('sendChat').onclick = async () => {
    const inp = document.getElementById('chatIn');
    if(!inp.value.trim()) return;
    const data = await api('GET');
    data.chat = data.chat || [];
    data.chat.push({ dev: MY_ID, txt: inp.value.trim() });
    await api('PUT', data);
    inp.value = '';
    updateChat();
};

/* AUTH */
document.getElementById('genBtn').onclick = async () => {
    const uid = document.getElementById('userid').value.trim();
    if(!uid) return;
    
    const status = document.getElementById('statusMsg');
    status.innerText = "Checking permissions...";
    
    const data = await api('GET');
    data.keys = data.keys || {};
    data.bans = data.bans || [];
    data.registry = data.registry || {};

    if(data.bans.includes(uid)) {
        status.innerText = "ðŸš« ACCESS DENIED: USER BANNED";
        return;
    }

    // CHECK FOR MULTIPLE KEYS (No new key until old one expires)
    const existing = Object.entries(data.keys).find(([k, v]) => v.uid === uid && (v.exp > now() || v.exp === 0));
    if(existing) {
        status.innerText = "âš ï¸ ACTIVE KEY ALREADY EXISTS";
        status.style.color = "var(--secondary)";
        document.getElementById('keyOut').innerText = existing[0];
        return;
    }

    const key = "RSQ-" + Math.random().toString(36).substr(2, 8).toUpperCase();
    data.keys[key] = { uid, dev: MY_ID, exp: now() + 86400 }; // Default 24h
    data.registry[MY_ID] = { last: Date.now() };
    
    await api('PUT', data);
    status.innerText = "âœ… KEY ACTIVATED";
    status.style.color = "var(--success)";
    document.getElementById('keyOut').innerText = key;
};

/* FEEDBACK */
function toggleFeedback() { document.getElementById('feedbackPanel').classList.toggle('hidden'); }
async function sendFeedback() {
    const msg = document.getElementById('feedMsg').value;
    const data = await api('GET');
    data.feedback = data.feedback || [];
    data.feedback.push({ dev: MY_ID, msg, time: new Date().toLocaleString() });
    await api('PUT', data);
    alert("Sent!");
    toggleFeedback();
}

/* ADMIN LOGIC */
document.getElementById('adminBtn').onclick = () => document.getElementById('adminInput').classList.toggle('hidden');
document.getElementById('adminInput').onchange = function() {
    if(this.value === MASTER_KEY) {
        document.getElementById('adminPanel').classList.remove('hidden');
        renderAdmin();
    }
};

async function nukeAll() {
    if(!confirm("ðŸš¨ WARNING: This will PERMANENTLY delete ALL keys, bans, feedback, and logs. Continue?")) return;
    await api('PUT', { keys: {}, registry: {}, bans: [], feedback: [], chat: [] });
    alert("System Wiped.");
    location.reload();
}

async function manualBan() {
    const id = prompt("Enter Roblox UserID to ban:");
    if(!id) return;
    const data = await api('GET');
    data.bans = data.bans || [];
    if(!data.bans.includes(id)) data.bans.push(id);
    await api('PUT', data);
    alert("User Banned.");
    renderAdmin();
}

async function keyAction(action, key) {
    const data = await api('GET');
    if(action === 'del') delete data.keys[key];
    if(action === 'ren') data.keys[key].exp = now() + 86400;
    if(action === 'inf') data.keys[key].exp = 0;
    await api('PUT', data);
    renderAdmin();
}

async function renderAdmin() {
    const data = await api('GET');
    window.currentData = data;
    filterAdmin();
}

function filterAdmin() {
    const term = document.getElementById('adminSearch').value.toUpperCase();
    const data = window.currentData;
    
    const keyLogs = document.getElementById('keyLogs');
    keyLogs.innerHTML = Object.entries(data.keys || {})
        .filter(([k, v]) => k.includes(term) || v.dev.includes(term) || v.uid.includes(term))
        .map(([k, v]) => {
            const isInf = v.exp === 0;
            const isExp = !isInf && v.exp < now();
            const status = isInf ? "INFINITE" : (isExp ? "EXPIRED" : "ACTIVE");
            return `<div class="msg-item">
                <b>${k}</b> [${status}]<br>
                UID: ${v.uid} | DEV: ${v.dev}<br>
                <button class="mini" style="background:var(--danger)" onclick="keyAction('del','${k}')">Delete</button>
                <button class="mini" style="background:var(--success)" onclick="keyAction('ren','${k}')">Renew 24h</button>
                <button class="mini" style="background:purple" onclick="keyAction('inf','${k}')">Make INF</button>
            </div>`;
        }).join('');

    const feedLogs = document.getElementById('feedLogs');
    feedLogs.innerHTML = (data.feedback || [])
        .filter(f => f.dev.includes(term) || f.msg.toUpperCase().includes(term))
        .map(f => `<div class="msg-item"><b>${f.dev} (${f.time})</b>${f.msg}</div>`).join('');
        
    document.getElementById('banDisplay').innerHTML = "<b>Banned UserIDs:</b> " + (data.bans || []).join(', ');
}

setInterval(updateChat, 5000);
updateChat();
</script>
</body>
</html>
