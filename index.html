<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RSQ Elite | System Overseer</title>

<style>
:root {
    --primary: #4f7cff;
    --secondary: #00d2ff;
    --danger: #ff3b30;
    --success: #28cd41;
    --warning: #ffcc00;
    --glass: rgba(15, 20, 30, 0.85);
    --border: rgba(255, 255, 255, 0.1);
}

body {
    margin: 0;
    background: #05070a;
    font-family: 'Segoe UI', system-ui, sans-serif;
    color: white;
    overflow: hidden;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Base Animations */
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-10px); } }
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
}

.animate-fade { animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
.animate-shake { animation: shake 0.2s ease-in-out 0s 2; }

/* Snowflake Animation */
.snowflake { color: #fff; font-size: 1em; position: fixed; top: -10%; z-index: 0; user-select: none; animation: fall linear infinite, shake_snow ease-in-out infinite; }
@keyframes fall { 0% { top: -10%; } 100% { top: 110%; } }
@keyframes shake_snow { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(50px); } }

#bg-wrap { position: fixed; inset: 0; background: radial-gradient(circle at center, #0f172a 0%, #05070a 100%); z-index: -1; }

.panel {
    position: relative;
    z-index: 10;
    width: 450px;
    background: var(--glass);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 30px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.hidden { display: none !important; }

input, textarea, select {
    width: 100%;
    box-sizing: border-box;
    padding: 12px;
    margin-top: 10px;
    background: rgba(0,0,0,0.4);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: white;
    outline: none;
    transition: border 0.3s ease;
}
input:focus { border-color: var(--secondary); }

button {
    width: 100%;
    padding: 12px;
    margin-top: 15px;
    border-radius: 10px;
    border: none;
    font-weight: 700;
    cursor: pointer;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
button:hover { transform: scale(1.02); filter: brightness(1.2); }
button:active { transform: scale(0.98); }
button.danger { background: linear-gradient(135deg, #ff3b30, #ff7b30); }
button.warning { background: linear-gradient(135deg, #ffcc00, #ffae00); color: #000; }

/* Chat Window Animation */
#chat-window {
    position: fixed; bottom: 90px; right: 25px; width: 320px; height: 450px;
    background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--border);
    border-radius: 15px; display: flex; flex-direction: column; z-index: 999; overflow: hidden;
    transform-origin: bottom right;
    transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.3s ease;
}
#chat-window.hidden { transform: scale(0); opacity: 0; display: flex !important; pointer-events: none; }

#chat-msgs { flex: 1; overflow-y: auto; padding: 15px; font-size: 13px; scroll-behavior: smooth; }

.msg-item { 
    margin-bottom: 10px; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px; 
    position: relative; animation: fadeIn 0.3s ease forwards; 
}

/* Admin Panel Transition */
.adminFull {
    position: fixed; inset: 15px; background: #0b0f1a; border-radius: 20px;
    padding: 25px; z-index: 2000; overflow-y: auto; border: 1px solid var(--border);
    transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}
.adminFull.hidden { opacity: 0; transform: scale(0.95); display: block !important; pointer-events: none; }
</style>
</head>
<body>

<div id="bg-wrap"></div>

<div id="authPanel" class="panel animate-fade">
    <h1 style="text-align:center; margin:0;">RSQ <span style="color:var(--secondary)">GATE</span></h1>
    <div id="loginView">
        <input id="l-user" placeholder="Username">
        <input id="l-pass" type="password" placeholder="Password">
        <button onclick="handleAuth('login')">Sign In</button>
        <p style="text-align:center; font-size:12px;">New? <a href="#" onclick="toggleAuth(true)" style="color:var(--secondary)">Create Account</a></p>
    </div>
    <div id="signupView" class="hidden">
        <input id="s-user" placeholder="Choose Username">
        <input id="s-pass" type="password" placeholder="Choose Password">
        <button onclick="handleAuth('signup')">Sign Up</button>
        <p style="text-align:center; font-size:12px;">Have account? <a href="#" onclick="toggleAuth(false)" style="color:var(--secondary)">Sign In</a></p>
    </div>
    <div id="authStatus" style="text-align:center; color:var(--danger); font-size:12px; margin-top:10px;"></div>
</div>

<div id="mainSystem" class="hidden">
    <div id="userPanel" class="panel animate-fade">
        <h1 style="text-align:center; margin:0;">RSQ <span style="color:var(--secondary)">ELITE</span></h1>
        <p id="welcomeUser" style="text-align:center; opacity:0.5; font-size: 11px;"></p>
        
        <input id="userid" placeholder="Roblox UserID">
        <button id="genBtn">Generate Access Key</button>
        <div id="statusMsg" style="text-align:center; margin-top:10px; font-size:12px; color:var(--danger);"></div>
        <div id="keyOut" style="text-align:center; margin-top:10px; color:var(--secondary); font-family:monospace; font-weight:bold;"></div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:20px;">
            <button id="adminBtn" class="danger">Admin</button>
            <button style="background:none; border: 1px solid var(--border);" onclick="logout()">Logout</button>
        </div>
        <input id="adminInput" class="hidden" type="password" placeholder="Master Key">
    </div>

    <div id="chat-toggle" onclick="toggleChat()">ðŸ’¬</div>
    <div id="chat-window" class="hidden">
        <div style="padding:10px; background:rgba(255,255,255,0.05); font-size:12px; font-weight:bold;">NETWORK CHAT</div>
        <div id="pinned-area" class="hidden"></div>
        <div id="chat-msgs"></div>
        <div style="padding:10px; display:flex; gap:5px;">
            <input id="chatIn" placeholder="Message..." style="margin:0; font-size:12px;">
            <button id="sendChat" style="margin:0; width:50px;">âž”</button>
        </div>
    </div>
</div>

<div id="adminPanel" class="adminFull hidden">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>ðŸ‘‘ OVERSEER CONTROL</h2>
        <div style="display:flex; gap:10px;">
            <button onclick="nukeAll()" class="danger" style="width:auto; margin:0;">NUKE ALL</button>
            <button onclick="document.getElementById('adminPanel').classList.add('hidden')" style="width:auto; margin:0; background:#444;">Exit</button>
        </div>
    </div>

    <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:15px; margin-top:20px;">
        <h3 style="margin-top:0">ðŸ”¨ Global Ban System</h3>
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
            <input id="banUserId" placeholder="Target Roblox ID">
            <div style="display:flex; gap:5px;">
                <input id="banTime" type="number" placeholder="Value" style="width:60px">
                <select id="banUnit" style="width:auto">
                    <option value="3600">Hours (H)</option>
                    <option value="86400">Days (D)</option>
                    <option value="604800">Weeks (W)</option>
                    <option value="2592000">Months (M)</option>
                </select>
            </div>
            <input id="banReason" placeholder="Reason/Message">
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
            <button onclick="processBan()">BAN USER ID</button>
            <button class="warning" onclick="sendGlobalMsg(true)">SEND LIVE (PINNED)</button>
            <button class="warning" onclick="sendGlobalMsg(false)">GLOBAL ANNOUNCEMENT</button>
        </div>
    </div>
    
    <input id="adminSearch" placeholder="Search Logs..." style="margin-top:20px;" oninput="renderAdmin()">
    <div class="admin-grid" style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:20px; margin-top:20px;">
        <div><h3>System Keys</h3><div id="keyLogs" style="background:rgba(255,255,255,0.03); padding:15px; border-radius:12px; height:400px; overflow-y:auto;"></div></div>
        <div><h3>Active Users</h3><div id="userLogs" style="background:rgba(255,255,255,0.03); padding:15px; border-radius:12px; height:400px; overflow-y:auto;"></div></div>
        <div><h3>Banned Database</h3><div id="banLogs" style="background:rgba(255,255,255,0.03); padding:15px; border-radius:12px; height:400px; overflow-y:auto;"></div></div>
    </div>
</div>

<script>
const BIN_ID = "694c4aefae596e708faef157";
const JSON_KEY = "$2a$10$DgQd.qgYLB2nv9e9ZFktKeUUkzZfmqPnL4Fk7JLvnN/ASlctW.8Cu";
const MASTER_KEY = "roblox";

const now = () => Math.floor(Date.now()/1000);

async function api(method, data = null) {
    const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}${method==='GET'?'/latest':''}`, {
        method: method,
        headers: { "Content-Type": "application/json", "X-Master-Key": JSON_KEY },
        body: data ? JSON.stringify(data) : null
    });
    const res = await r.json();
    return res.record;
}

/* UI HELPERS */
function triggerShake(elementId) {
    const el = document.getElementById(elementId);
    el.classList.remove('animate-shake');
    void el.offsetWidth; // Force reflow
    el.classList.add('animate-shake');
}

function toggleAuth(isSignup) {
    const authPanel = document.getElementById('authPanel');
    authPanel.style.opacity = '0';
    setTimeout(() => {
        document.getElementById('signupView').classList.toggle('hidden', !isSignup);
        document.getElementById('loginView').classList.toggle('hidden', isSignup);
        authPanel.style.opacity = '1';
    }, 200);
}

function toggleChat() {
    document.getElementById('chat-window').classList.toggle('hidden');
}

async function handleAuth(type) {
    const status = document.getElementById('authStatus');
    status.innerText = "Syncing...";
    
    try {
        const data = await api('GET');
        data.users ||= {};

        if(type === 'signup') {
            const u = document.getElementById('s-user').value.trim();
            const p = document.getElementById('s-pass').value.trim();
            if(!u || !p) { triggerShake('authPanel'); return status.innerText = "Fields empty"; }
            data.users[u] = { pass: p, dev: "LINKED", warns: 0 };
            await api('PUT', data);
            status.innerText = "Created! Signing in...";
            toggleAuth(false);
        } else {
            const u = document.getElementById('l-user').value.trim();
            const p = document.getElementById('l-pass').value.trim();
            if(data.users[u] && data.users[u].pass === p) {
                // FADE OUT LOGIN -> FADE IN SYSTEM
                document.getElementById('authPanel').style.animation = "fadeOut 0.4s forwards";
                setTimeout(() => {
                    document.getElementById('authPanel').classList.add('hidden');
                    document.getElementById('mainSystem').classList.remove('hidden');
                    document.getElementById('welcomeUser').innerText = `USER: ${u}`;
                    startChatLoop();
                }, 400);
            } else {
                triggerShake('authPanel');
                status.innerText = "Invalid credentials";
            }
        }
    } catch(e) { status.innerText = "API Error"; }
}

function logout() {
    document.body.style.opacity = '0';
    document.body.style.transition = 'opacity 0.5s';
    setTimeout(() => location.reload(), 500);
}

/* KEY GEN ANIMATION */
document.getElementById('genBtn').onclick = async () => {
    const rbxId = document.getElementById('userid').value.trim();
    const status = document.getElementById('statusMsg');
    
    if(!rbxId) {
        triggerShake('userPanel');
        status.innerText = "Enter Roblox ID!";
        return;
    }

    status.innerText = "Generating...";
    const data = await api('GET');
    data.keys ||= {};

    const newKey = "RSQ-" + Math.random().toString(36).substr(2, 9).toUpperCase();
    data.keys[newKey] = { user: "Admin", rbx: rbxId, exp: now() + 86400 };

    await api('PUT', data);
    status.style.color = "var(--success)";
    status.innerText = "SUCCESS!";
    document.getElementById('keyOut').innerText = newKey;
    document.getElementById('keyOut').classList.add('animate-fade');
};

/* CHAT LOOP */
function startChatLoop() { setInterval(updateChat, 4000); updateChat(); }

async function updateChat() {
    const data = await api('GET');
    const box = document.getElementById('chat-msgs');
    box.innerHTML = (data.chat || []).map(m => `
        <div class="msg-item"><b>${m.user}</b> ${m.txt}</div>
    `).join('');
}

/* ADMIN AUTH */
document.getElementById('adminBtn').onclick = () => document.getElementById('adminInput').classList.toggle('hidden');
document.getElementById('adminInput').onchange = function() {
    if(this.value === MASTER_KEY) {
        document.getElementById('adminPanel').classList.remove('hidden');
        renderAdmin();
    } else {
        triggerShake('userPanel');
        this.value = "";
    }
};

async function renderAdmin() {
    const data = await api('GET');
    document.getElementById('keyLogs').innerHTML = Object.entries(data.keys || {}).map(([k, v]) => `
        <div class="msg-item"><b>${k}</b> <br> ID: ${v.rbx}</div>
    `).join('');
}

function nukeAll() { if(confirm("Nuke everything?")) location.reload(); }
</script>

</body>
</html>
