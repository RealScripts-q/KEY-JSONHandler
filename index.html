<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RSQ Key System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#070707;
  font-family:system-ui;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card {
  width:420px;
  background:#121212;
  border-radius:18px;
  padding:20px;
  box-shadow:0 0 40px rgba(0,120,255,.25);
}
h1 { font-size:18px; margin:0; }
p { font-size:13px; color:#aaa; }

input,button {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:none;
}
input {
  background:#0b0b0b;
  color:#fff;
  border:1px solid #222;
}
button {
  background:linear-gradient(135deg,#007aff,#00c6ff);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}
button.secondary {
  background:linear-gradient(135deg,#ff6a00,#ff9500);
}
button:disabled {
  opacity:.5;
  cursor:not-allowed;
}

.status { margin-top:10px; font-size:13px; }
.timer { margin-top:8px; font-size:13px; color:#00c6ff; }
.cooldown { margin-top:6px; font-size:12px; color:#ff9500; }
.hidden { display:none; }
</style>
</head>

<body>
<div class="card">
  <h1>üîë RSQ Key System</h1>
  <p>Paste your Roblox UserId to get or recover a key</p>

  <input id="userid" placeholder="Roblox UserId">
  <button id="gen">Generate / Recover Key</button>

  <button id="renewBtn" class="secondary hidden">üîê Force / Renew Key</button>
  <input id="resetToken" class="hidden" placeholder="Paste reset token from Roblox">

  <div class="status" id="status"></div>
  <div class="timer" id="timer"></div>
  <div class="cooldown" id="cooldown"></div>
</div>

<script>
/* ================= CONFIG ================= */
const BIN_ID = "694c4aefae596e708faef157";
const MASTER_KEY = "PUT_YOUR_MASTER_KEY_HERE";

const KEY_LIFE = 86400;
const RESET_COOLDOWN = 21600;

/* ================= STATE ================= */
let keyInterval = null;
let cooldownInterval = null;
let activeKeyData = null;

/* ================= HELPERS ================= */
const now = () => Math.floor(Date.now()/1000);
const makeKey = () => "RSQ-" + crypto.randomUUID().slice(0,8).toUpperCase();

function startKeyTimer(exp) {
  clearInterval(keyInterval);
  keyInterval = setInterval(() => {
    const r = exp - now();
    if (r <= 0) {
      timer.textContent = "‚õî Key expired";
      clearInterval(keyInterval);
      return;
    }
    timer.textContent =
      `‚è± ${Math.floor(r/3600)}h ${Math.floor(r%3600/60)}m ${r%60}s left`;
  }, 1000);
}

function startCooldown(lastReset) {
  clearInterval(cooldownInterval);

  function tick() {
    const r = (lastReset + RESET_COOLDOWN) - now();
    if (r <= 0) {
      cooldown.textContent = "";
      renewBtn.classList.remove("hidden");
      clearInterval(cooldownInterval);
      return;
    }
    cooldown.textContent =
      `üîí Reset cooldown: ${Math.floor(r/3600)}h ${Math.floor(r%3600/60)}m ${r%60}s`;
    renewBtn.classList.add("hidden");
  }

  tick();
  cooldownInterval = setInterval(tick, 1000);
}

/* ================= JSONBIN ================= */
async function getKeys() {
  const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`);
  return (await r.json()).record.keys || {};
}

async function saveKeys(keys) {
  await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
    method:"PUT",
    headers:{
      "Content-Type":"application/json",
      "X-Master-Key":MASTER_KEY
    },
    body:JSON.stringify({ keys })
  });
}

/* ================= GENERATE / RECOVER ================= */
gen.onclick = async () => {
  const id = userid.value.trim();
  if (!/^\d+$/.test(id))
    return status.textContent = "‚ùå Invalid UserId";

  status.textContent = "üîç Checking keys...";
  const keys = await getKeys();

  for (const k in keys) {
    const d = keys[k];
    if (d.userId == id && d.expires > now()) {
      activeKeyData = d;
      navigator.clipboard.writeText(k);
      status.textContent = "‚úÖ Existing key copied";
      startKeyTimer(d.expires);
      renewBtn.classList.remove("hidden");
      if (d.lastReset) startCooldown(d.lastReset);
      return;
    }
  }

  const key = makeKey();
  keys[key] = {
    userId:Number(id),
    created:now(),
    expires:now()+KEY_LIFE,
    lastReset:0,
    resetToken:crypto.randomUUID().slice(0,6).toUpperCase()
  };

  await saveKeys(keys);
  navigator.clipboard.writeText(key);
  status.textContent = "‚úÖ New key generated & copied";
  startKeyTimer(keys[key].expires);
  renewBtn.classList.remove("hidden");
};

/* ================= RESET ================= */
renewBtn.onclick = () => {
  resetToken.classList.toggle("hidden");
  status.textContent = "üîê Paste reset token from Roblox";
};

resetToken.onchange = async () => {
  const token = resetToken.value.trim().toUpperCase();
  const id = userid.value.trim();
  if (!token || !id) return;

  const keys = await getKeys();

  for (const k in keys) {
    const d = keys[k];
    if (d.userId == id && d.resetToken === token) {

      if (d.lastReset && now() - d.lastReset < RESET_COOLDOWN)
        return status.textContent = "‚è≥ Reset cooldown active";

      delete keys[k];

      const nk = makeKey();
      keys[nk] = {
        userId:d.userId,
        created:now(),
        expires:now()+KEY_LIFE,
        lastReset:now(),
        resetToken:crypto.randomUUID().slice(0,6).toUpperCase()
      };

      await saveKeys(keys);
      navigator.clipboard.writeText(nk);

      status.textContent =
        "‚úÖ Successfully reset your key ‚Äî paste your username to get a new one";
      resetToken.value = "";
      resetToken.classList.add("hidden");

      startKeyTimer(keys[nk].expires);
      startCooldown(keys[nk].lastReset);
      return;
    }
  }

  status.textContent = "‚ùå Invalid reset key";
};
</script>
</body>
</html>
