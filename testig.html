<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RSQ Key System</title>

<style>
body{
  margin:0;
  height:100vh;
  background:#0b0d14;
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:Segoe UI, sans-serif;
  color:white;
}
.box{
  width:400px;
  background:#12121a;
  padding:20px;
  border-radius:16px;
}
h3{
  text-align:center;
  color:#50c8ff;
}
input,button{
  width:100%;
  height:36px;
  border-radius:10px;
  border:none;
  margin-top:10px;
}
input{
  background:#0e0e16;
  color:white;
  padding:10px;
}
button{
  background:#0080ff;
  color:white;
  font-weight:600;
  cursor:pointer;
}
.status{
  margin-top:12px;
  text-align:center;
  font-size:13px;
}
.ok{color:#46ff8c}
.err{color:#ff5050}
</style>
</head>

<body>

<div class="box" id="ui">
  <h3>üîê RSQ Key System</h3>
  <input id="keyInput" placeholder="Paste your key">
  <button onclick="verifyKey()">Verify Key</button>
  <div class="status" id="status">Waiting for key...</div>
</div>

<script>
/* ================= CONFIG ================= */

const JSONBIN_URL =
  "https://api.jsonbin.io/v3/b/694c4aefae596e708faef157/latest";

const JSONBIN_MASTER_KEY =
  "$2a$10$7MPZXICawr4gE5o3N/KXiOaEMdx9qUL/c1Ht4TEnfO8DYmK2Tqiae"; // ‚ö†Ô∏è NOT SECURE

const USER_ID = 123456789; // simulate Roblox Player.UserId
const RECHECK_INTERVAL = 15000;

/* ================= STATE ================= */

let currentKey = null;

/* ================= HELPERS ================= */

function setStatus(msg, cls=""){
  const s = document.getElementById("status");
  s.textContent = msg;
  s.className = "status " + cls;
}

async function fetchData(){
  try{
    const res = await fetch(JSONBIN_URL, {
      headers: {
        "X-Master-Key": JSONBIN_MASTER_KEY
      }
    });
    const json = await res.json();
    return json.record;
  }catch(e){
    return null;
  }
}

/* ================= VALIDATION ================= */

function checkKeyState(key, data){
  const now = Math.floor(Date.now()/1000);

  // BAN CHECK
  if(data.bans && data.bans[String(USER_ID)]){
    if(data.bans[String(USER_ID)] > now){
      alert("üö´ You were banned from using the script");
      location.reload();
      return "BANNED";
    }
  }

  // KEY EXISTS
  if(!data.keys || !data.keys[key]){
    return "DELETED";
  }

  const info = data.keys[key];

  // USER BIND
  if(Number(info.userId) !== USER_ID){
    return "INVALID";
  }

  // EXPIRY
  if(info.expires !== 0 && info.expires < now){
    return "EXPIRED";
  }

  return "VALID";
}

/* ================= VERIFY FLOW ================= */

async function verifyKey(){
  const key = document.getElementById("keyInput").value.trim();
  if(!key) return;

  setStatus("Checking key...");

  const data = await fetchData();
  if(!data){
    setStatus("‚ö†Ô∏è Network error","err");
    return;
  }

  const state = checkKeyState(key,data);

  if(state !== "VALID"){
    if(state === "EXPIRED") setStatus("‚è∞ Key expired","err");
    else setStatus("‚ùå Invalid key","err");
    return;
  }

  // SUCCESS
  currentKey = key;
  localStorage.setItem("rsq_key", key);

  setStatus("‚úÖ Key valid","ok");
  document.getElementById("ui").style.display = "none";

  startLiveRecheck();
}

/* ================= LIVE RECHECK ================= */

function startLiveRecheck(){
  setInterval(async ()=>{
    if(!currentKey) return;

    const data = await fetchData();
    if(!data) return;

    const state = checkKeyState(currentKey,data);
    if(state === "VALID") return;

    currentKey = null;
    document.getElementById("ui").style.display = "block";
    setStatus("‚ùå Key revoked","err");

  }, RECHECK_INTERVAL);
}

/* ================= AUTO LOAD ================= */

const saved = localStorage.getItem("rsq_key");
if(saved){
  document.getElementById("keyInput").value = saved;
  verifyKey();
}
</script>

</body>
</html>
