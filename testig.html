<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RSQ Key System</title>

<style>
  * {
    box-sizing: border-box;
    font-family: "Segoe UI", sans-serif;
  }

  body {
    margin: 0;
    height: 100vh;
    background: radial-gradient(circle at top, #0e111a, #07090f);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
  }

  .frame {
    width: 420px;
    background: #12121a;
    border-radius: 16px;
    padding: 18px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.7);
  }

  .title {
    text-align: center;
    color: #50c8ff;
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 16px;
  }

  input {
    width: 100%;
    height: 36px;
    border-radius: 10px;
    border: none;
    outline: none;
    padding: 0 12px;
    background: #0e0e16;
    color: #fff;
    margin-bottom: 12px;
  }

  button {
    width: 100%;
    height: 34px;
    border-radius: 10px;
    border: none;
    background: linear-gradient(135deg, #007bff, #00a2ff);
    color: #fff;
    font-weight: 600;
    cursor: pointer;
  }

  .status {
    margin-top: 14px;
    font-size: 13px;
    text-align: center;
    color: #c8c8c8;
  }

  .error { color: #ff5050; }
  .valid { color: #46ff8c; }
</style>
</head>

<body>

<div class="frame" id="ui">
  <div class="title">üîê RSQ Key System</div>
  <input id="keyInput" placeholder="Paste your key">
  <button onclick="verifyKey()">Verify Key</button>
  <div class="status" id="status">Waiting for key...</div>
</div>

<script>
/* --------------------------------------------------
   CONFIG
-------------------------------------------------- */

const JSONBIN_URL =
  "https://api.jsonbin.io/v3/b/694c4aefae596e708faef157/latest";

const SCRIPT_URLS = [
  "D.lua",
  "I.lua",
  "N.lua"
];

const USER_ID = 123456789; // simulated Player.UserId
const RECHECK_INTERVAL = 15000;

/* --------------------------------------------------
   STATE
-------------------------------------------------- */

let currentKey = null;
let scriptsLoaded = false;
let liveCheckRunning = false;

/* --------------------------------------------------
   HELPERS
-------------------------------------------------- */

function setStatus(text, type = "") {
  const s = document.getElementById("status");
  s.textContent = text;
  s.className = "status " + type;
}

async function fetchData() {
  try {
    const res = await fetch(JSONBIN_URL);
    const json = await res.json();
    return json.record;
  } catch {
    return null;
  }
}

/* --------------------------------------------------
   VALIDATION (1:1 WITH LUA)
-------------------------------------------------- */

function checkKeyState(key, data) {

  // BAN CHECK
  if (data.bans && data.bans[USER_ID]) {
    if (data.bans[USER_ID] > Math.floor(Date.now() / 1000)) {
      alert("üö´ You were banned from using the script");
      location.reload();
      return "BANNED";
    }
  }

  // KEY EXISTS
  if (!data.keys || !data.keys[key]) {
    return "DELETED";
  }

  const info = data.keys[key];

  // USER BIND
  if (Number(info.userId) !== USER_ID) {
    return "INVALID";
  }

  // EXPIRY
  if (info.expires !== 0 && info.expires < Math.floor(Date.now() / 1000)) {
    return "EXPIRED";
  }

  return "VALID";
}

/* --------------------------------------------------
   LOAD SCRIPTS (SIMULATED)
-------------------------------------------------- */

function loadScripts() {
  if (scriptsLoaded) return;
  scriptsLoaded = true;

  SCRIPT_URLS.forEach(url => {
    console.log("Loaded script:", url);
  });
}

/* --------------------------------------------------
   LIVE RECHECK LOOP
-------------------------------------------------- */

function startLiveRecheck() {
  if (liveCheckRunning) return;
  liveCheckRunning = true;

  setInterval(async () => {
    if (!currentKey) return;

    const data = await fetchData();
    if (!data) return;

    const state = checkKeyState(currentKey, data);

    if (state === "VALID") return;

    // FAIL
    currentKey = null;
    scriptsLoaded = false;
    document.getElementById("ui").style.display = "block";

    if (state === "DELETED")
      setStatus("üóëÔ∏è Your key was removed by an admin", "error");
    if (state === "EXPIRED")
      setStatus("‚è∞ Your key has expired", "error");
    if (state === "INVALID")
      setStatus("‚ùå Invalid key", "error");

  }, RECHECK_INTERVAL);
}

/* --------------------------------------------------
   VERIFY FLOW
-------------------------------------------------- */

async function verifyKey() {
  const key = document.getElementById("keyInput").value.trim();
  if (!key) return;

  setStatus("Checking key...");

  const data = await fetchData();
  if (!data) {
    setStatus("‚ö†Ô∏è Network error", "error");
    return;
  }

  const state = checkKeyState(key, data);

  if (state !== "VALID") {
    if (state === "EXPIRED") setStatus("‚è∞ Key expired", "error");
    else setStatus("‚ùå Invalid key", "error");
    return;
  }

  // SUCCESS
  currentKey = key;
  localStorage.setItem("rsq_key", key);

  setStatus("‚úÖ Key valid", "valid");
  document.getElementById("ui").style.display = "none";

  loadScripts();
  startLiveRecheck();
}

/* --------------------------------------------------
   AUTO LOAD SAVED KEY
-------------------------------------------------- */

const savedKey = localStorage.getItem("rsq_key");
if (savedKey) {
  document.getElementById("keyInput").value = savedKey;
  verifyKey();
}
</script>

</body>
</html>
 
